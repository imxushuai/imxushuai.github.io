---
title: 学成在线笔记一：项目概述与CMS接口开发
tags:
  - 学成在线项目
  - 黑马学成在线
  - 在线教育项目
  - 实战学成在线
  - 学成在线笔记
categories:
  - 学成在线
date: 2020-06-10 23:17:42
---

<center><i>项目概述与 CMS 接口开发</i></center>

![](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/master/jiaoyu.jpg)

<!-- more -->

# 项目介绍

## 项目概述

学成在线借鉴了`MOOC`（大型开放式网络课程，即`MOOC`（massive open online courses））的设计思想，是一个提供IT职业课程在线学习的平台，它为即将和已经加入IT领域的技术人才提供在线学习服务，用户通过在线学习、在线练习、在线考试等学习内容，最终掌握所学的IT技能，并能在工作中熟练应用。

## 功能模块

当前市场的在线教育模式多种多样，包括：B2C、C2C、B2B2C等业务模式，学成在线采用B2B2C业务模式，即向企业或个人提供在线教育平台提供教学服务，老师和学生通过平台完成整个教学和学习的过程，市场上类似的平台有：网易云课堂、腾讯课堂等，学成在线的特点是IT职业课程在线教学。

![](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/master/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E5%9B%BE.jpg)

大模块介绍：

| 功能模块名称 | 功能说明                                                     |
| ------------ | ------------------------------------------------------------ |
| 门户         | 在首页、活动页、专题页等页面提供课程学习入口。               |
| 学习中心     | 学生登录学习中心在线学习课程。                               |
| 社交系统     | 社交系统为老师和学生交流搭建沟通的平台，包括：问答系统、评论系统、论坛等，<br/>学生和老师通过问答系统提问问题、回答问题，通过评论系统对老师授课进行评论。 |
| 教学管理中心 | 教师登录教学管理中心进行课程管理、资源管理、考试管理等教学活动。 |
| 系统管理中心 | 系统管理员登录系统管理中心进行分类管理、运维管理等功能。     |

## 技术架构

学成在线采用当前流行的前后端分离架构开发，由用户层、UI层、微服务层、数据层等部分组成，为PC、App、H5等客户端用户提供服务。下图是系统的技术架构图：

![](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/master/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E5%9B%BE.jpg)

各模块说明：

| 序号 | 名称         | 功能描述                                                     |
| ---- | ------------ | ------------------------------------------------------------ |
| 1    | 用户层       | 用户层描述了本系统所支持的用户类型包括：pc用户、app用户、h5用户。pc用户通过<br/>浏览器访问系统、app用户通过android、ios手机访问系统，H5用户通过h5页面访问系<br/>统。 |
| 2    | CDN          | CDN全称Content Delivery Network，即内容分发网络，本系统所有静态资源全部通过<br/>CDN加速来提高访问速度。系统静态资源包括：html页面、js文件、css文件、image图<br/>片、pdf和ppt及doc教学文档、video视频等。 |
| 3    | 负载均衡     | 系统的CDN层、UI层、服务层及数据层均设置了负载均衡服务，上图仅在UI层前边标注<br/>了负载均衡。每一层的负载均衡会根据系统的需求来确定负载均衡器的类型，系统支持<br/>4层负载均衡+7层负载均衡结合的方式，4层负载均衡是指在网络传输层进行流程转发，<br/>根据IP和端口进行转发，7层负载均衡完成HTTP协议负载均衡及反向代理的功能，根据<br/>url进行请求转发。 |
| 4    | UI层         | UI层描述了系统向pc用户、app用户、h5用户提供的产品界面。根据系统功能模块特点<br/>确定了UI层包括如下产品界面类型：1）面向pc用户的门户系统、学习中心系统、教学<br/>管理系统、系统管理中心。2）面向h5用户的门户系统、学习中心系统。3）面向app<br/>用户的门户系统、学习中心系统未在上图标注，在app项目中有详细说明。 |
| 5    | 微服务层     | 微服务层将系统服务分类三类：前端服务、后端服务及系统服务。前端服务：主要为学<br/>习用户提供学习服务。后端服务：主要为管理用户提供教学管理服务。系统服务：公<br/>共服务，为系统的所有微服务提供公共服务功能。服务网关：提供服务路由、负载均<br/>衡、认证授权等服务。 |
| 6    | 数据层       | 数据层描述了系统的数据存储的内容类型，持久化的业务数据使用MySQL和MongoDB<br/>保存，其中MongoDB中主要保存系统日志信息。消息队列：存储系统服务间通信的消<br/>息，本身提供消息存取服务，与微服务层的系统服务连接。索引库：存储课程信息的索<br/>引信息，本身提供索引维护及搜索的服务，与微服务层的系统服务连接。缓存：作为系<br/>统的缓存服务，存储课程信息、分类信息、用户信息等，与微服务层的所有服务连接。<br/>文件存储：提供系统静态资源文件的分布式存储服务，文件存储服务器作为CDN服务器<br/>的数据来源，CDN上的静态资源将最终在文件存储服务器上保存多份。流媒体服务：<br/>作为流媒体服务器，存储所有的流媒体文件。 |
| 7    | 外部系统接口 | 1）微信、QQ、微博登录接口，本系统和微信、QQ、微博系统对接，用户输入微信、<br/>QQ、微博的账号和密码即可登录本系统。2）微信、QQ、微博分享接口，本系统和微<br/>信、QQ、微博系统对接，可直接将本系统的课程资源信息分享到微信、QQ、微博。<br/>3）支付宝、微信、网银支付接口，本系统提供支付宝、微信、网银三种支付接口。<br/>4）短信接口，本系统与第三方平台对接短信发送接口。5）邮件接口，本系统需要连<br/>接第三方的smpt邮件服务器对外发送电子邮件。6）微信公众号，本系统与微信公众号<br/>平台接口，用户通过微信公众号访问H5页面。7）点播、直播，前期视频点播与直播采<br/>用第三方服务方式，本系统与第三方点、直播服务对接，对外提供视频点播与直播服<br/>务。8）OSS存储，前期静态资源文件的存储采用第三方服务方式，本系统与第三方提<br/>供的OSS存储服务对接，将系统的静态资源文件存储到第三方提供的OSS存储服务器<br/>上。9）CDN，本系统与第三方CDN服务对接，使用CDN加速服务来提高本系统的访问<br/>速度。 |
| 8    | DevOps       | DevOps（英文Development和Operations的组合）是一组过程、方法与系统的统称，<br/>用于促进开发（应用程序/软件工程）、技术运营和质量保障（QA）部门之间的沟通、<br/>协作与整合。本项目供了许多开发、运营、维护支撑的系统，包括：Eureka服务治理<br/>中心：提供服务治理服务，包括：服务注册、服务获取等。Spring Cloud Conﬁg服务<br/>配置管理中心：提供服务配置管理服务，包括：配置文件更新、配置文件下发等。<br/>Hystrix Dashboard服务熔断监控：监控熔断的请求响应时间、成功率等。Zipkin服务<br/>追踪监控：监控服务调用链路健康情况。Jenkins持续集成服务：提供系统持续集成服<br/>务。Git/GitLab代码管理服务:提供git代码管理服务。ELK日志分析服务:提供elk日志分<br/>析服务，包括系统运行日志分析、告警服务。Docker容器化部署服务：将本系统所有<br/>服务采用容器化部署方式。Maven项目管理工具：提供管理项目所有的Java包依赖、项<br/>目工程打包服务。 |

## 技术栈

![](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/master/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E6%8A%80%E6%9C%AF%E6%A0%88.jpg)

重点了解微服务技术栈

学成在线服务端基于Spring Boot构建，采用Spring Cloud微服务框架。

- 持久层：MySQL、MongoDB、Redis、ElasticSearch

- 数据访问层：使用Spring Data JPA 、Mybatis、Spring Data Mongodb等

- 业务层：Spring IOC、Aop事务控制、Spring Task任务调度、Feign、Ribbon、Spring AMQP、Spring Data Redis等。

- 控制层：Spring MVC、FastJSON、RestTemplate、Spring Security Oauth2+JWT等

- 微服务治理：Eureka、Zuul、Hystrix、Spring Cloud Conﬁg等

# CMS需求分析

## 什么是CMS

`CMS` （Content Management System）即内容管理系统，不同的项目对`CMS`的定位不同，比如：一个在线教育网站，有些公司认为`CMS`系统是对所有的课程资源进行管理，而在早期网站刚开始盛行时很多公司的业务是网站制作，当时对`CMS`的定位是创建网站，即对网站的页面、图片等静态资源进行管理。

## CMS有哪些类型

`CMS`基本上分为：针对后台数据内容的管理、针对前端页面的管理、针对样式风格的管理等。比如：一个给企业做网站的公司，其`CMS`系统主要是网站页面管理及样式风格的管理。

## 本项目CMS的定位是什么

本项目作为一个大型的在线教育平台，对`CMS`系统的定位是对各各网站（子站点）页面的管理，主要管理由于运营需要而经常变动的页面，从而实现根据运营需要快速进行页面开发、上线的需求。

## 导入基础工程与Nginx配置（省略）

## CMS页面管理需求

### 这些页面的管理流程是什么？

1. 创建站点

   一个网站有很多子站点，比如：学成在线有主门户、学习中心、问答系统等子站点。具体的哪个页面是归属于具体的站点，所以要管理页面，先要管理页面所属的站点。

2. 创建模板

   页面如何创建呢？比如电商网站的商品详情页面，每个页面的内容布局、板式是相同的，不同的只是内容，这个页面的布局、板式就是页面模板，模板+数据就组成一个完整的页面，最终要创建一个页面文件需要先定义此页面的模板，最终拿到页面的数据再结合模板就拼装成一个完整的页面。

3. 创建页面

   创建页面是指填写页面的基本信息，如：页面的名称、页面的url地址等。

4. 页面预览

   页面预览是页面发布前的一项工作，页面预览使用静态化技术根据页面模板和数据生成页面内容，并通过浏览器预览页面。页面发布前进行页面预览的目是为了保证页面发布后的正确性。

5. 页面发布

   使用计算机技术将页面发送到页面所在站点的服务器，页面发布成功就可以通过浏览器来访问了。

### 本项目要实现什么样的功能？

1. 页面管理

   管理员在后台添加、修改、删除页面信息。

2. 页面预览

   管理员通过页面预览功能预览页面发布后的效果。

3. 页面发布

   管理员通过页面发布功能将页面发布到远程门户服务器。页面发布成功，用户即可在浏览器浏览到最新发布的页面，整个页面添加、发布的过程由于软件自动执行，无需人工登录服务器操作。

# CMS接口开发

## 工程导入（省略）

**注意：**

​	我这里导入遇到一个坑，`xc-framework-common`的依赖中`spring-cloud-starter-feign`导入不成功，在`Spring Boot 2.x`后，该依赖更名了，需要将该依赖修改为：`spring-cloud-starter-openfeign`（不需要输入版本号）。

## MongoDB安装以及集合导入（省略）

## 请求与响应对象



### 接收请求参数对象

定义请求模型`QueryPageRequest`，此模型作为查询条件类型

```java
package com.xuecheng.framework.domain.cms.request;

import com.xuecheng.framework.model.request.RequestData;
import lombok.Data;

@Data
public class QueryPageRequest extends RequestData {
    
    //站点id
    private String siteId;
    //页面ID
    private String pageId;
    //页面名称
    private String pageName;
    //别名
    private String pageAliase;
    //模版id
    private String templateId;

}
```

### 响应结果对象

```java
package com.xuecheng.framework.model.response;

import lombok.Data;
import lombok.ToString;

@Data
@ToString
public class QueryResponseResult extends ResponseResult {

    QueryResult queryResult;

    public QueryResponseResult(ResultCode resultCode,QueryResult queryResult){
        super(resultCode);
       this.queryResult = queryResult;
    }

}
```

## API接口定义

在`xc-service-api`中定义接口，进行接口的统一管理

```java
package com.xuecheng.api.cms;

import com.xuecheng.framework.domain.cms.request.QueryPageRequest;
import com.xuecheng.framework.model.response.QueryResponseResult;

public interface CmsPageControllerApi {

    QueryResponseResult findList(int page, int size, QueryPageRequest queryPageRequest);

}
```

## API接口实现

创建`xc-service-manage-cms`工程。

### pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>xc-service-api</artifactId>
        <groupId>com.xuecheng</groupId>
        <version>1.0-SNAPSHOT</version>
        <relativePath>../xc-service-api/pom.xml</relativePath>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>xc-service-manage-cms</artifactId>

    <dependencies>
        <dependency>
            <groupId>com.xuecheng</groupId>
            <artifactId>xc-service-api</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>
        <dependency>
            <groupId>com.xuecheng</groupId>
            <artifactId>xc-framework-model</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>
        <dependency>
            <groupId>com.xuecheng</groupId>
            <artifactId>xc-framework-utils</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>
        <dependency>
            <groupId>com.xuecheng</groupId>
            <artifactId>xc-framework-common</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-freemarker</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-mongodb</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-amqp</artifactId>
        </dependency>
        <dependency>
            <groupId>com.squareup.okhttp3</groupId>
            <artifactId>okhttp</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-mongodb</artifactId>
        </dependency>
    </dependencies>

</project>
```

### application.yml

```yaml
server:
    port: 31001
spring:
  application:
      name: xc‐service‐manage‐cms
  data:
    mongodb:
      uri: mongodb://192.168.136.110:27017/
      database: xc_cms
```

### 启动类

```java
package com.xuecheng.manage_cms;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.autoconfigure.domain.EntityScan;
import org.springframework.context.annotation.ComponentScan;

@SpringBootApplication
@EntityScan("com.xuecheng.framework.domain.cms")
@ComponentScan(basePackages={"com.xuecheng.api"})
@ComponentScan(basePackages={"com.xuecheng.manage_cms"})
public class ManageCmsApplication {

    public static void main(String[] args) {
        SpringApplication.run(ManageCmsApplication.class, args);
    }

}
```

### Dao

```java
package com.xuecheng.manage_cms.dao;

import com.xuecheng.framework.domain.cms.CmsPage;
import org.springframework.data.mongodb.repository.MongoRepository;

public interface CmsPageRepository extends MongoRepository<CmsPage, String> {
}
```

### Service

```java
package com.xuecheng.manage_cms.service;

import com.xuecheng.framework.domain.cms.CmsPage;
import com.xuecheng.framework.domain.cms.request.QueryPageRequest;
import com.xuecheng.framework.model.response.CommonCode;
import com.xuecheng.framework.model.response.QueryResponseResult;
import com.xuecheng.framework.model.response.QueryResult;
import com.xuecheng.manage_cms.dao.CmsPageRepository;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.stereotype.Service;

@Slf4j
@Service
public class CmsPageService {

    @Autowired
    private CmsPageRepository cmsPageRepository;

    public QueryResponseResult findList(int page, int size, QueryPageRequest queryPageRequest) {
        if (page <= 0) {
            page = 1;
        }
        // 页码从0开始
        page = page - 1;
        // 查询
        Page<CmsPage> pageResult = cmsPageRepository.findAll(PageRequest.of(page, size));
        QueryResult<CmsPage> cmsPageQueryResult = new QueryResult<>();
        cmsPageQueryResult.setList(pageResult.getContent());
        cmsPageQueryResult.setTotal(pageResult.getTotalElements());
        
        return new QueryResponseResult(CommonCode.SUCCESS, cmsPageQueryResult);
    }
}
```

### Controller

```java
package com.xuecheng.manage_cms.controller;

import com.xuecheng.api.cms.CmsPageControllerApi;
import com.xuecheng.framework.domain.cms.request.QueryPageRequest;
import com.xuecheng.framework.model.response.QueryResponseResult;
import com.xuecheng.manage_cms.service.CmsPageService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("cms/page")
public class CmsPageController implements CmsPageControllerApi {

    @Autowired
    private CmsPageService cmsPageService;

    @Override
    @GetMapping("list/{page}/{size}")
    public QueryResponseResult findList(@PathVariable("page") int page,
                                        @PathVariable("size") int size,
                                        QueryPageRequest queryPageRequest) {
        return cmsPageService.findList(page, size, queryPageRequest);
    }
}
```

### 测试

![](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/master/20190910225535.png)

# Swagger

OpenAPI规范（OpenAPI Speciﬁcation 简称OAS）是Linux基金会的一个项目，试图通过定义一种用来描述API格式或API定义的语言，来规范RESTful服务开发过程，目前版本是V3.0，并且已经发布并开源在github上。

https://github.com/OAI/OpenAPI-Specification

Swagger是全球最大的OpenAPI规范（OAS）API开发工具框架，支持从设计和文档到测试和部署的整个API生命周期的开发。

https://swagger.io/

Spring Boot 可以集成Swagger，生成Swagger接口，Spring Boot是Java领域的神器，它是Spring项目下快速构建项目的框架。

## 常用注解

- @Api：修饰整个类，描述`Controller`的作用`@ApiOperation`：描述一个类的一个方法，或者说一个接口。

- @ApiParam：单个参数描述
- @ApiModel：用对象来接收参数
- @ApiModelProperty：用对象接收参数时，描述对象的一个字段
- @ApiResponse：HTTP响应其中1个描述
- @ApiResponses：HTTP响应整体描述
- @ApiIgnore：使用该注解忽略这个API 
- @ApiError ：发生错误返回的信息
- @ApiImplicitParam：一个请求参数
- @ApiImplicitParams：多个请求参数

### @ApiImplicitParams参数介绍

| 属性         | 取值       | 作用                                |
| ------------ | ---------- | ----------------------------------- |
| paramType    |            | 查询的参数类型                      |
|              | path       | 以地址的形式提交数据                |
|              | query      | 直接跟参数完成自动映射赋值          |
|              | body       | 以流的形式提交（POST请求）          |
|              | header     | 参数携带在request headers（请求头） |
|              | form       | 以form表单的形式提交（POST）        |
| dataType     |            | 参数的数据类型（只是用于展示）      |
|              | Long       |                                     |
|              | String     |                                     |
| name         |            | 接收参数名                          |
| value        |            | 该参数的描述                        |
| required     | true/false | 参数是否必填                        |
| defaultValue |            | 默认值                              |

## Swagger配置类

```java
package com.xuecheng.api.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;

@Configuration
@EnableSwagger2
public class Swagger2Configuration {
    @Bean
    public Docket createRestApi() {
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(apiInfo())
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.xuecheng"))
                .paths(PathSelectors.any())
                .build();
    }

    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("学成网api文档")
                .description("学成网api文档")
                .version("1.0")
                .build();
    }

}
```

## Swagger接口定义

修改`CmsPageControllerApi`，使用`Swagger`相关注解

```java
package com.xuecheng.api.cms;

import com.xuecheng.framework.domain.cms.request.QueryPageRequest;
import com.xuecheng.framework.model.response.QueryResponseResult;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiImplicitParam;
import io.swagger.annotations.ApiImplicitParams;
import io.swagger.annotations.ApiOperation;

@Api(value = "CMS页面管理接口", description = "CMS页面管理接口，提供页面的增删改查")
public interface CmsPageControllerApi {

    @ApiOperation("分页查询页面列表")
    @ApiImplicitParams(
            @ApiImplicitParam(name = "page", value = "页码", required = true, paramType = "path", dataType = "int"),
            @ApiImplicitParam(name = "size", value = "每页记录数", required = true, paramType = "path", dataType = "int")
    )
    QueryResponseResult findList(int page, int size, QueryPageRequest queryPageRequest);

}
```

在`QueryPageRequest`使用`@ApiModelProperty`对属性进行解析

```java
package com.xuecheng.framework.domain.cms.request;

import com.xuecheng.framework.model.request.RequestData;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

@Data
public class QueryPageRequest extends RequestData {

    //站点id
    @ApiModelProperty("站点ID")
    private String siteId;
    //页面ID
    @ApiModelProperty("页面ID")
    private String pageId;
    //页面名称
    @ApiModelProperty("页面名称")
    private String pageName;
    //别名
    @ApiModelProperty("页面别名")
    private String pageAliase;
    //模版id
    @ApiModelProperty("模板ID")
    private String templateId;

}
```

## 访问测试

访问地址：[http://localhost:31001/swagger-ui.html](http://localhost:31001/swagger-ui.html)

![](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/master/20190910225629.png)

# 代码获取

[代码获取](https://www.imxushuai.com/2020/07/01/35.%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E4%BB%A3%E7%A0%81%E8%8E%B7%E5%8F%96/)