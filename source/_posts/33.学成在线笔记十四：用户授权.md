---
title: å­¦æˆåœ¨çº¿ç¬”è®°åå››ï¼šç”¨æˆ·æˆæƒ
tags:
  - å­¦æˆåœ¨çº¿é¡¹ç›®
  - é»‘é©¬å­¦æˆåœ¨çº¿
  - åœ¨çº¿æ•™è‚²é¡¹ç›®
  - å®æˆ˜å­¦æˆåœ¨çº¿
  - å­¦æˆåœ¨çº¿ç¬”è®°
categories:
  - å­¦æˆåœ¨çº¿
abbrlink: 62278
date: 2020-06-26 17:55:06
---

<center><i>ç”¨æˆ·æˆæƒã€æ•°æ®ç»†ç²’åº¦åŠå¾®æœåŠ¡ä¹‹é—´è°ƒç”¨æºå¸¦ JWT ä»¤ç‰Œ</i></center>

![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/jiaoyu.jpg)

<!-- more -->

# ç”¨æˆ·æˆæƒ

## éœ€æ±‚åˆ†æ

1. ç®¡ç†å‘˜ç»™ç”¨æˆ·åˆ†é…æƒé™ï¼Œæƒé™æ•°æ®å†™åˆ°æ•°æ®åº“ä¸­ã€‚
2. è®¤è¯æœåŠ¡åœ¨è¿›è¡Œç”¨æˆ·è®¤è¯æ—¶ä»æ•°æ®åº“è¯»å–ç”¨æˆ·çš„æƒé™æ•°æ®ï¼ˆåŠ¨æ€æ•°æ®ï¼‰

## æƒé™æ•°æ®æ¨¡å‹

äº”å¼ è¡¨ï¼Œæ ‡å‡†çš„æƒé™æ¨¡å‹è®¾è®¡ã€‚

æ¯”è¾ƒç®€å•æ˜“æ‡‚ã€‚

![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/å­¦æˆåœ¨çº¿-ç”¨æˆ·æƒé™æ¨¡å‹.jpg)

- xc_user

  ç”¨æˆ·è¡¨ï¼Œå­˜å‚¨äº†ç³»ç»Ÿç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·ç±»å‹åŒ…æ‹¬ï¼šå­¦ç”Ÿã€è€å¸ˆã€ç®¡ç†å‘˜ç­‰

- xc_role

  è§’è‰²è¡¨ï¼Œå­˜å‚¨äº†ç³»ç»Ÿçš„è§’è‰²ä¿¡æ¯ï¼Œå­¦ç”Ÿã€è€å¸ˆã€æ•™å­¦ç®¡ç†å‘˜ã€ç³»ç»Ÿç®¡ç†å‘˜ç­‰

- xc_user_role

  ç”¨æˆ·è§’è‰²è¡¨ï¼Œä¸€ä¸ªç”¨æˆ·å¯æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼Œä¸€ä¸ªè§’è‰²å¯è¢«å¤šä¸ªç”¨æˆ·æ‰€æ‹¥æœ‰

- xc_menu

  æ¨¡å—è¡¨ï¼Œè®°å½•äº†èœå•åŠèœå•ä¸‹çš„æƒé™

- xc_permission

  è§’è‰²æƒé™è¡¨ï¼Œä¸€ä¸ªè§’è‰²å¯æ‹¥æœ‰å¤šä¸ªæƒé™ï¼Œä¸€ä¸ªæƒé™å¯è¢«å¤šä¸ªè§’è‰²æ‰€æ‹¥æœ‰

## ç”¨æˆ·ä¸­å¿ƒæŸ¥è¯¢æƒé™åˆ—è¡¨

### Dao

- XcMenuMapper

  ```java
  package com.xuecheng.ucenter.dao;
  
  import com.xuecheng.framework.domain.ucenter.XcMenu;
  import org.apache.ibatis.annotations.Mapper;
  
  import java.util.List;
  
  @Mapper
  public interface XcMenuMapper {
      List<XcMenu> selectPermissionByUserId(String userid);
  
  }
  ```

- XcMenuMapper.xml

  ```xml
  <?xml version="1.0" encoding="UTF-8" ?>
  <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
  <mapper namespace="com.xuecheng.ucenter.dao.XcMenuMapper">
      <select id="selectPermissionByUserId"
              resultType=
                      "com.xuecheng.framework.domain.ucenter.XcMenu" parameterType=
                      "java.lang.String">
          SELECT
              id,
              CODE,
              p_id pId,
              menu_name menuName,
              url,
              is_menu isMenu,
              LEVEL,
              sort,
              STATUS,
              icon,
              create_time createTime,
              update_time updateTime
          FROM
              xc_menu
          WHERE id IN(
              SELECT menu_id FROM xc_permission WHERE role_id IN (
                  SELECT role_id FROM xc_user_role WHERE user_id = #{id}
              )
          )
      </select>
  </mapper>
  ```

### Service

ä¿®æ”¹`UserService#findByUsername`æ–¹æ³•ï¼ŒæŸ¥è¯¢ç”¨æˆ·æƒé™

```java
    @Autowired
    private XcMenuMapper xcMenuMapper;


    /**
     * æŒ‰ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
     *
     * @param username ç”¨æˆ·å
     * @return ç”¨æˆ·ä¿¡æ¯
     */
    public XcUserExt findByUsername(String username) {
        XcUserExt result = new XcUserExt();

        // æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
        XcUser userInfo = xcUserRepository.findByUsername(username);
        if (userInfo == null) {
            return null;
        }

        BeanUtils.copyProperties(userInfo, result);

        // æŸ¥è¯¢ç”¨æˆ·å…¬å¸ä¿¡æ¯
        XcCompanyUser companyUser = xcCompanyUserRepository.findByUserId(userInfo.getId());
        if (companyUser != null) {
            result.setCompanyId(companyUser.getCompanyId());
        }

        // æŸ¥è¯¢ç”¨æˆ·æƒé™
        List<XcMenu> xcMenus = xcMenuMapper.selectPermissionByUserId(userInfo.getId());
        result.setPermissions(xcMenus);

        return result;
    }
```

 ## è®¤è¯æœåŠ¡è®¾ç½®ç”¨æˆ·æƒé™

ä¿®æ”¹è®¤è¯å¾®æœåŠ¡ä¸­æˆæƒéƒ¨åˆ†çš„ä»£ç ï¼Œä½¿ç”¨æŸ¥è¯¢åˆ°çš„ç”¨æˆ·æƒé™è¿›è¡Œç”¨æˆ·æˆæƒã€‚

![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/QQæˆªå›¾20200623232453.png)

```java
        List<String> stringList = userext.getPermissions()
                .stream()
                .map(XcMenu::getCode)
                .collect(Collectors.toList());
        String[] permissionList = new String[stringList.size()];
        UserJwt userDetails = new UserJwt(username,
                password,
                AuthorityUtils.createAuthorityList(stringList.toArray(permissionList)));
```

## å¼‚å¸¸å¤„ç†

æƒé™ä¸è¶³ä¸ºç‰¹æ®Šçš„å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨ï¼Œæ•æ‰å¼‚å¸¸ç„¶åæŠ›å‡ºã€‚

ä¿®æ”¹`xc-framework-common`ä¸­çš„`ExceptionCatch`ä¸­çš„é™æ€ä»£ç å—

```java
    static {
        OPTIONS = builder
                .put(HttpMessageNotReadableException.class, CommonCode.PARAMS_ERROR)
                .put(MissingServletRequestPartException.class, CommonCode.PARAMS_ERROR)
                .put(AccessDeniedException.class, CommonCode.UNAUTHORISE)
                .build();

    }
```

æ–°å¢ä¸Š`AccessDeniedException`çš„é”™è¯¯ç å³å¯ã€‚

## æ§åˆ¶æ¥å£æƒé™

æ§åˆ¶æ¥å£æƒé™éœ€è¦ä¸‹åˆ—æ­¥éª¤ï¼š

1. éœ€è¦æ§åˆ¶æ¥å£çš„å¾®æœåŠ¡ï¼Œéœ€è¦å…ˆå¼•å…¥`Spring Security`çš„ä¾èµ–
2. æ‹·è´`ResourceServerConfig`ç±»
3. æ‹·è´å…¬é’¥
4. `ResourceServerConfig`éœ€è¦æ³¨è§£`@EnableGlobalMethodSecurity(prePostEnabled = true, securedEnabled = true)`
5. åœ¨éœ€è¦æ§åˆ¶æƒé™çš„æ¥å£ä¸Šæ·»åŠ æ³¨è§£`@PreAuthorize("hasAuthority('{permission_str}')")`

## æµ‹è¯•

ç™»å½•åè·å–`token`ï¼Œè§£æ`token`ï¼ŒæŸ¥çœ‹æ˜¯å¦åŒ…å«`permiss`åˆ—è¡¨

![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/QQæˆªå›¾20200623232748.png)

æˆ‘è¿™é‡Œæ˜¯åœ¨`JWT`å®˜ç½‘è§£æçš„ï¼Œç½‘å€ï¼šğŸ‘‰[https://jwt.io/](https://jwt.io/)ğŸ‘ˆ

# å‰ç«¯é›†æˆè®¤è¯æˆæƒ

è¿™é‡Œä»¥`æ•™å­¦ç®¡ç†ä¸­å¿ƒ`æ¨¡å—ä¸ºä¾‹

## éœ€æ±‚åˆ†æ

å‰ç«¯é›†æˆè®¤è¯æˆæƒåŠŸèƒ½éœ€è¦ä½œå¦‚ä¸‹å·¥ä½œï¼š

1. å‰ç«¯é¡µé¢æ ¡éªŒç”¨æˆ·çš„èº«ä»½ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰ç™»å½•åˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢
2. å‰ç«¯è¯·æ±‚èµ„æºæœåŠ¡éœ€è¦åœ¨`http header`ä¸­æ·»åŠ `jwtä»¤ç‰Œ`ï¼Œèµ„æºæœåŠ¡æ ¹æ®`jwtä»¤ç‰Œ`å®Œæˆæˆæƒã€‚

å“ªäº›åŠŸèƒ½éœ€è¦å‰ç«¯è¯·æ±‚æ—¶æºå¸¦`JWT`ï¼Ÿ

ç”¨æˆ·ç™»å½•æˆåŠŸè¯·æ±‚èµ„æºæœåŠ¡éƒ½éœ€è¦æºå¸¦`jwtä»¤ç‰Œ`ï¼Œå› ä¸ºèµ„æºæœåŠ¡å·²ç»å®ç°äº†`jwt`è®¤è¯ï¼Œå¦‚æœæ ¡éªŒå¤´éƒ¨æ²¡æœ‰`jwt`åˆ™ä¼šè®¤ä¸ºèº«ä»½ä¸åˆæ³•ã€‚

## é…ç½®Nginx

æ•™å­¦ç®¡ç†å‰ç«¯è®¿é—®å¾®æœåŠ¡ç»Ÿä¸€åœ¨è®¿é—®åœ°å€å‰æ·»åŠ `/api`å‰ç¼€å¹¶ç»è¿‡ç½‘å…³è½¬å‘åˆ°å¾®æœåŠ¡ã€‚

é…ç½®`teacher.xuecheng.com`çš„ä»£ç†ã€‚

```conf
	#å‰ç«¯æ•™å­¦ç®¡ç†
	upstream teacher_server_pool{
		server 127.0.0.1:12000 weight=10;
	}
	#æ–‡ä»¶æœåŠ¡
	upstream filesystem_server_pool{
		server 127.0.0.1:22100 weight=10;
	} 
	#åª’èµ„æœåŠ¡
	upstream media_server_pool{
		server 127.0.0.1:31400 weight=10;
	}
	#å­¦æˆç½‘æ•™å­¦ç®¡ç†ä¸­å¿ƒ
	server {
		listen       80;
		server_name teacher.xuecheng.com;
		#ä¸ªäººä¸­å¿ƒ
		location / {  
			proxy_pass http://teacher_server_pool;  
		} 
		location /api {  
			proxy_pass http://api_server_pool;  
		}
		location /filesystem {  
			proxy_pass http://filesystem_server_pool;  
		}
		#åª’èµ„ç®¡ç†
		location ^~ /api/media/ {  
			proxy_pass http://media_server_pool/media/;  
		} 
		#è®¤è¯
		location ^~ /openapi/auth/ {  
			proxy_pass http://auth_server_pool/auth/;  
		} 
	 
	}
```

## å‰ç«¯ä»£ç 

å…¶ä»–çš„å‰ç«¯ä»£ç åŸºæœ¬éƒ½æ˜¯å®ç°äº†çš„ï¼Œåªéœ€è¦åœ¨`main.js`æŠŠæ³¨é‡Šç¬¦å»æ‰å°±è¡Œäº†ã€‚

å‰ç«¯ä»£ç å°±ä¸åšå¤šçš„è§£æäº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±ç ”ç©¶ã€‚

# ç»†ç²’åº¦æˆæƒ

æ„Ÿè§‰å«ç»†ç²’åº¦æˆæƒæœ‰ç‚¹æ€ªæ€ªçš„ï¼Œè¿™æ›´åƒæ˜¯ä¸šåŠ¡é€»è¾‘ã€‚

## éœ€æ±‚åˆ†æ

1. æˆ‘çš„è¯¾ç¨‹æŸ¥è¯¢ï¼Œç»†ç²’åº¦æˆæƒè¿‡ç¨‹å¦‚ä¸‹
   - è·å–å½“å‰ç™»å½•çš„ç”¨æˆ·Id
   - å¾—åˆ°ç”¨æˆ·æ‰€å±æ•™è‚²æœºæ„çš„Id
   - æŸ¥è¯¢è¯¥æ•™å­¦æœºæ„ä¸‹çš„è¯¾ç¨‹ä¿¡æ¯
2. ä¿®æ”¹è¯¾ç¨‹ç®¡ç†æœåŠ¡â€œæˆ‘çš„è¯¾ç¨‹â€çš„åŠŸèƒ½ï¼Œæ ¹æ®å…¬å¸IdæŸ¥è¯¢è¯¾ç¨‹
   - ä¿®æ”¹Daoï¼Œæ”¯æŒæ ¹æ®å…¬å¸Id æŸ¥è¯¢è¯¾ç¨‹
   - ä¿®æ”¹Serviceï¼Œå°†å…¬å¸Idä¼ å…¥Dao
   - ä¿®æ”¹Controllerï¼Œè·å–å½“å‰ç”¨æˆ·çš„å…¬å¸Idï¼Œä¼ ç»™Service

## è·å–å½“å‰ç™»å½•ç”¨æˆ·

### JWTä»¤ç‰Œè§£æ

å› ä¸ºä¹‹å‰æˆ‘ä»¬å·²ç»åœ¨ç™»å½•çš„æ—¶å€™ï¼Œå°†ç”¨æˆ·çš„`company_id`æ”¾åœ¨äº†ä»¤ç‰Œä¸­ï¼Œæˆ‘ä»¬ç°åœ¨åªéœ€è¦è§£æä»¤ç‰Œå°±å¯ä»¥è·å–åˆ°å½“å‰ç™»å½•ç”¨æˆ·çš„`company_id`

- å·¥å…·ç±»ä»£ç 

  ```java
  package com.xuecheng.framework.utils;
  
  import com.alibaba.fastjson.JSON;
  import org.apache.commons.lang3.StringUtils;
  import org.springframework.security.jwt.Jwt;
  import org.springframework.security.jwt.JwtHelper;
  
  import javax.servlet.http.HttpServletRequest;
  import java.util.Map;
  
  public class Oauth2Util {
  
      public static Map<String,String> getJwtClaimsFromHeader(HttpServletRequest request) {
          if (request == null) {
              return null;
          }
          //å–å‡ºå¤´ä¿¡æ¯
          String authorization = request.getHeader("Authorization");
          if (StringUtils.isEmpty(authorization) || authorization.indexOf("Bearer") < 0) {
              return null;
          }
          //ä»Bearer åè¾¹å¼€å§‹å–å‡ºtoken
          String token = authorization.substring(7);
          Map<String,String> map = null;
          try {
              //è§£æjwt
              Jwt decode = JwtHelper.decode(token);
              //å¾—åˆ° jwtä¸­çš„ç”¨æˆ·ä¿¡æ¯
              String claims = decode.getClaims();
              //å°†jwtè½¬ä¸ºMap
              map = JSON.parseObject(claims, Map.class);
          } catch (Exception e) {
              e.printStackTrace();
      
          }
          return map;
      }
  }
  ```

  

- å°†å·¥å…·è§£æåˆ°çš„æ•°æ®å°è£…ä¸ºæƒ³è¦çš„æ•°æ®ç»“æ„

  ```java
  package com.xuecheng.framework.utils;
  
  import lombok.Data;
  import org.apache.commons.lang3.StringUtils;
  
  import javax.servlet.http.HttpServletRequest;
  import java.util.Map;
  
  public class XcOauth2Util {
  
      public UserJwt getUserJwtFromHeader(HttpServletRequest request){
          Map<String, String> jwtClaims = Oauth2Util.getJwtClaimsFromHeader(request);
          if(jwtClaims == null || StringUtils.isEmpty(jwtClaims.get("id"))){
              return null;
          }
          UserJwt userJwt = new UserJwt();
          userJwt.setId(jwtClaims.get("id"));
          userJwt.setName(jwtClaims.get("name"));
          userJwt.setCompanyId(jwtClaims.get("companyId"));
          userJwt.setUtype(jwtClaims.get("utype"));
          userJwt.setUserpic(jwtClaims.get("userpic"));
          return userJwt;
      }
  
      @Data
      public class UserJwt{
          private String id;
          private String name;
          private String userpic;
          private String utype;
          private String companyId;
      }
  
  }
  ```

## è¯¾ç¨‹ç®¡ç†æ”¹é€ 

### è¯¾ç¨‹ç®¡ç†æ–°å¢API

åœ¨`CourseBaseControllerApi`ä¸­æ–°å¢æ–¹æ³•

```java
QueryResponseResult findCourseList(int page, int size, CourseListRequest courseListRequest);
```

### Dao

ä¿®æ”¹ `CourseMapper.xml`çš„æŸ¥è¯¢è¯¾ç¨‹åˆ—è¡¨ï¼Œæ·»åŠ `companyId`æ¡ä»¶ã€‚

```java
    <select id="findCourseListPage" resultType="com.xuecheng.framework.domain.course.ext.CourseInfo"
            parameterType="com.xuecheng.framework.domain.course.request.CourseListRequest">
        SELECT
            course_base.*,
            (SELECT pic FROM course_pic WHERE courseid = course_base.id) pic
        FROM
            course_base
        where course_base.company_id = #{companyId}
    </select>
```

### CourseBaseService

```java
    /**
     * æŸ¥è¯¢å½“å‰ç™»å½•ç”¨æˆ·çš„è¯¾ç¨‹åˆ—è¡¨
     *
     * @param companyId         å½“å‰ç”¨æˆ·çš„æ‰€å±å…¬å¸
     * @param page              å½“å‰é¡µ
     * @param size              æ¯é¡µè®°å½•æ•°
     * @param courseListRequest æŸ¥è¯¢æ¡ä»¶
     * @return è¯¾ç¨‹åˆ—è¡¨
     */
    public QueryResponseResult findCourseList(String companyId, int page, int size, CourseListRequest courseListRequest) {
        if(courseListRequest == null){
            courseListRequest = new CourseListRequest();
        }
        // è®¾ç½®companyid
        courseListRequest.setCompanyId(companyId);
        // åˆ†é¡µ
        PageHelper.startPage(page, size);
        // è°ƒç”¨dao
        com.github.pagehelper.Page<CourseInfo> courseListPage = courseMapper.findCourseListPage(courseListRequest);
        List<CourseInfo> list = courseListPage.getResult();
        long total = courseListPage.getTotal();
        QueryResult<CourseInfo> courseInfoQueryResult = new QueryResult<>();
        courseInfoQueryResult.setList(list);
        courseInfoQueryResult.setTotal(total);
        return new QueryResponseResult(CommonCode.SUCCESS,courseInfoQueryResult);
    }
```

> éœ€è¦å¼•å…¥`PageHelper`çš„ä¾èµ–
>
> ```xml
> <dependency>
>     <groupId>com.github.pagehelper</groupId>
>     <artifactId>pagehelper-spring-boot-starter</artifactId>
> </dependency>
> ```

### CourseBaseController

å®ç°`findCourseList`æ–¹æ³•

```java
    @Override
    @GetMapping("/list/{page}/{size}")
    public QueryResponseResult findCourseList(@PathVariable int page, @PathVariable int size,
                                              CourseListRequest courseListRequest) {
        // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
        XcOauth2Util xcOauth2Util = new XcOauth2Util();
        XcOauth2Util.UserJwt userJwt = xcOauth2Util.getUserJwtFromHeader(request);
        // ä½¿ç”¨companyIdæŸ¥è¯¢æ•°æ®
        return courseBaseService.findCourseList(userJwt.getCompanyId(), page, size, courseListRequest);
    }
```

### æµ‹è¯•

æˆ‘ä»`postman`èƒ½å¤ŸæˆåŠŸè·å–åˆ°æ•°æ®ã€‚

ç”¨å‰ç«¯å»ï¼Œæˆ‘å‘ç°`teacher.xucheng.com`è¿™è¾¹çš„`sessionStorage`é‡Œé¢æ ¹æœ¬æ²¡æœ‰å­˜ä»¤ç‰Œä¸çŸ¥é“ä¸ºå•¥ï¼Œæ˜¯è·¨åŸŸå—ï¼Ÿè¿˜æ˜¯å…¶ä»–é—®é¢˜ï¼Œæäº†ä¸€ä¼šå„¿æ²¡è§£å†³ï¼Œç®—äº†ï¼Œæ‡’å¾—æäº†ã€‚

# å¾®æœåŠ¡ä¹‹é—´è®¤è¯

å¾®æœåŠ¡ä¹‹é—´çš„è°ƒç”¨ï¼Œä¹Ÿæ˜¯éœ€è¦æºå¸¦`jwtä»¤ç‰Œ`çš„ï¼Œä½†æ˜¯ç°åœ¨æ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è°ƒç”¨çš„æŸäº›éœ€è¦è°ƒç”¨å…¶ä»–å¾®æœåŠ¡çš„æ¥å£çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°`401`è®¤è¯å¤±è´¥çš„é”™è¯¯ã€‚

## Feignæ‹¦æˆªå™¨

### å®šä¹‰Feignæ‹¦æˆªå™¨

```java
package com.xuecheng.framework.intercepter;

import feign.RequestInterceptor;
import feign.RequestTemplate;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import javax.servlet.http.HttpServletRequest;
import java.util.Enumeration;

/**
 * feignæ‹¦æˆªå™¨, è°ƒç”¨å‰ä¼ é€’header
 */
public class FeignClientInterceptor implements RequestInterceptor {
    @Override
    public void apply(RequestTemplate requestTemplate) {
        try {
            // ä½¿ç”¨RequestContextHolderå·¥å…·è·å–requestç›¸å…³å˜é‡
            ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
            if(attributes!=null){
                // å–å‡ºrequest
                HttpServletRequest request = attributes.getRequest();
                Enumeration<String> headerNames = request.getHeaderNames();
                if (headerNames != null) {
                    while (headerNames.hasMoreElements()) {
                        String name = headerNames.nextElement();
                        String values = request.getHeader(name);
                        if(name.equals("authorization")){
                        System.out.println("name="+name+"values="+values);
                            requestTemplate.header(name, values);
                        }
                    }
                }
            }
        }catch (Exception e) {
            e.printStackTrace();
        }

    }
}
```

### ä½¿ç”¨Feignæ‹¦æˆªå™¨

åªéœ€è¦å°†ç¼–å†™çš„æ‹¦æˆªå™¨æ³¨å†Œåˆ°éœ€è¦ä½¿ç”¨è¯¥æ‹¦æˆªå™¨çš„å¾®æœåŠ¡çš„`spring`å®¹å™¨ä¸­å³å¯.

ä¸æƒ³å•æ‹å‡ºæ¥å¯ä»¥ç›´æ¥åœ¨å¯åŠ¨ç±»ä¸­æ³¨å†Œ.

```java
@Bean
public FeignClientInterceptor feignClientInterceptor(){
return new FeignClientInterceptor();
}
```

# ä»£ç è·å–

[ä»£ç è·å–](https://www.imxushuai.com/2020/07/01/35.%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E4%BB%A3%E7%A0%81%E8%8E%B7%E5%8F%96/)