---
title: Linux与Java程序使用的时间不一致
tags:
  - 时区问题
  - timedatectl
  - nptdate
  - Centos时间错误
  - Linux时间错误
  - Linux Java时间错误
  - Centos Java时间错误
categories:
  - Bug处理
date: 2020-06-16 22:41:46
---

<center><i>Linux 与 Java 程序使用的时间不一致的处理方法</i></center>

![](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/370be382115ff9181ac5c755620615701c10dd8a/asdas1.png)

<!-- more -->

> 今天在公司部署系统时遇到了一个关于时区的问题，记录一下

# 问题描述

使用Java程序调用系统时间如图：

![https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/1503d943b6d6f0411a069a2a83904930100a77f2/QQ%E5%9B%BE%E7%89%8720200616154551.png](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/1503d943b6d6f0411a069a2a83904930100a77f2/QQ图片20200616154551.png)

可以看到时间`23:00`，当时的时间是下午的`15:00`

然后我用`ssh`工具连接到服务器查看时间，发现时间又是正确的。	

![https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/1503d943b6d6f0411a069a2a83904930100a77f2/QQ%E6%88%AA%E5%9B%BE20200616155046.png](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/1503d943b6d6f0411a069a2a83904930100a77f2/QQ截图20200616155046.png)

大致推断可能是时区设置没有同步好。

# 解决办法

1. 使用`timedatectl status`查看时区设置

   ![https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/1503d943b6d6f0411a069a2a83904930100a77f2/QQ%E6%88%AA%E5%9B%BE20200616154334.png](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/1503d943b6d6f0411a069a2a83904930100a77f2/QQ截图20200616154334.png)

   可以看到`RTC in local TZ:no`，说明硬件时钟未设置为本地时区。

2. 修改设置，使用命令

   ```shell
   timedatectl set-local-rtc 1
   ```

3. 再次查看时区设置

   ![https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/1503d943b6d6f0411a069a2a83904930100a77f2/QQ%E6%88%AA%E5%9B%BE20200616154348.png](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/1503d943b6d6f0411a069a2a83904930100a77f2/QQ截图20200616154348.png)

4. 修改完毕，我再去系统进行测试

   ![https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/1503d943b6d6f0411a069a2a83904930100a77f2/QQ%E6%88%AA%E5%9B%BE20200616155458.png](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/1503d943b6d6f0411a069a2a83904930100a77f2/QQ截图20200616155458.png)

5. 问题解决。

# 扩展

## timedatectl概述

timedatectl命令可以查询和更改系统时钟和设置，你可以使用此命令来设置或更改当前的日期，时间和时区，
或实现与远程NTP服务器的自动系统时钟同步。

> 注意：datetimectl命令自CentOS7 版本被引入。

## 常用命令

 ### 查看当前时间/日期/时区

```shell
timedatectl status
# timedatectl也可以
```

### 查看所有可用时区

```shell
timedatectl list-timezones
```

### 设置时区

```shell
timedatectl set-timezone “时区信息”
```

### 设置UTC

```shell
timedatectl set-timezone UTC
```

### 设置时间

```shell
timedatectl set-time HH:MM:SS
```

### 设置日期

```shell
timedatectl set-time YYYY-MM-DD
```

### 设置日期时间

```shell
timedatectl set-time “YYYY-MM-DD HH:MM:SS”
```

### 设置硬件时钟为本地时间

```shell
timedatectl set-local-rtc 1
```

### 设置硬件时钟为UTC时间

```shell
timedatectl set-local-rtc 0
```

### 启动NTP时间同步

```shell
timedatectl set-ntp true
```

### 禁用NTP时间同步

```shell
timedatectl set-ntp false
```

## 更新系统时间

```shell
# 格式：ntpdate [-nv] [ IP/hostname]
ntpdate -u ntp.api.bz
```

提示：`command not found`，用`yum`安装一下

```shell
yum install -y ntpdate
```



