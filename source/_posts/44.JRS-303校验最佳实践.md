---
title: JRS-303æ ¡éªŒæœ€ä½³å®è·µ
tags:
  - JRS 303
  - JRS-303
  - å‚æ•°æ ¡éªŒ
  - Bean Validation
categories:
  - å…¶ä»–
abbrlink: 27819
date: 2021-12-16 20:24:33
---

<center><i>JRS 303 Bean Validation æœ€ä½³å®è·µ</i></center>

![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/JSR-303-banner.png)

<!-- more -->

# JSR-303æ˜¯ä»€ä¹ˆ

JSRå…¨ç§°ï¼šJava Specification Requestsã€‚

[JSR-303](https://link.jianshu.com/?t=https://jcp.org/en/jsr/detail?id=303) æ˜¯ Java EE 6 ä¸­çš„ä¸€é¡¹å­è§„èŒƒï¼Œå«åš Bean Validationï¼Œå®˜æ–¹å‚è€ƒå®ç°æ˜¯hibernate Validatorã€‚

Bean Validation ä¸º JavaBean éªŒè¯å®šä¹‰äº†ç›¸åº”çš„å…ƒæ•°æ®æ¨¡å‹å’Œ APIã€‚ç¼ºçœçš„å…ƒæ•°æ®æ˜¯ Java Annotationsï¼Œé€šè¿‡ä½¿ç”¨ XML å¯ä»¥å¯¹åŸæœ‰çš„å…ƒæ•°æ®ä¿¡æ¯è¿›è¡Œè¦†ç›–å’Œæ‰©å±•ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œé€šè¿‡ä½¿ç”¨ Bean Validation æˆ–æ˜¯ä½ è‡ªå·±å®šä¹‰çš„ constraintï¼Œä¾‹å¦‚ `@NotNull`, `@Max`, `@ZipCode` ï¼Œ å°±å¯ä»¥ç¡®ä¿æ•°æ®æ¨¡å‹ï¼ˆJavaBeanï¼‰çš„æ­£ç¡®æ€§ã€‚constraint å¯ä»¥é™„åŠ åˆ°å­—æ®µï¼Œgetter æ–¹æ³•ï¼Œç±»æˆ–è€…æ¥å£ä¸Šé¢ã€‚å¯¹äºä¸€äº›ç‰¹å®šçš„éœ€æ±‚ï¼Œç”¨æˆ·å¯ä»¥å¾ˆå®¹æ˜“çš„å¼€å‘å®šåˆ¶åŒ–çš„ constraintã€‚Bean Validation æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶çš„æ•°æ®éªŒè¯æ¡†æ¶ï¼Œåœ¨éªŒè¯ä¹‹åéªŒè¯çš„é”™è¯¯ä¿¡æ¯ä¼šè¢«é©¬ä¸Šè¿”å›ã€‚

# Bean Validation

Bean Validation ä¸­å†…ç½®çš„ ä¸€äº›constraint

å…¶æœ¬è´¨æ˜¯å°†ä¸€äº›å¸¸ç”¨çš„æ ¡éªŒè§„åˆ™å†…ç½®

| æ³¨è§£                         | å«ä¹‰                                                     |
| ---------------------------- | -------------------------------------------------------- |
| @Null                        | è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ºnull                                   |
| @NotNull                     | è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸ºnull                                 |
| @NotEmpty                    | è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ä¸ºnullä¸”ä¸ä¸ºç©ºå­—ç¬¦ä¸²                   |
| @NotBlank                    | è¢«æ³¨é‡Šçš„å…ƒç´ è‡³å°‘åŒ…å«ä¸€ä¸ªæœ‰æ•ˆå­—ç¬¦                         |
| @AssertTrue                  | è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ºtrue                                   |
| @AssertFalse                 | è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ä¸ºfalse                                  |
| @Minï¼ˆvalueï¼‰                | è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å¤§äºç­‰äºæŒ‡å®šçš„æœ€å°å€¼ |
| @Maxï¼ˆvalueï¼‰                | è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»å°äºç­‰äºæŒ‡å®šçš„æœ€å¤§å€¼ |
| @DecimalMinï¼ˆvalueï¼‰         | ä¸@Minä½œç”¨ç›¸åŒï¼Œä¸»è¦é’ˆå¯¹é«˜ç²¾åº¦çš„BigDecimalç±»å‹           |
| @DecimalMaxï¼ˆvalueï¼‰         | ä¸@Maxä½œç”¨ç›¸åŒï¼Œä¸»è¦é’ˆå¯¹é«˜ç²¾åº¦çš„BigDecimalç±»å‹           |
| @Sizeï¼ˆmaxï¼Œminï¼‰            | è¢«æ³¨é‡Šçš„å…ƒç´ çš„å¤§å°å¿…é¡»å†æŒ‡å®šçš„èŒƒå›´å†…                     |
| @digitsï¼ˆintegerï¼Œfractionï¼‰ | è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå…¶å€¼å¿…é¡»åœ¨å¯æ¥å—çš„èŒƒå›´å†…     |
| @Past                        | è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ                         |
| @Future                      | è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ                         |
| @Patternï¼ˆvalueï¼‰            | è¢«æ³¨é‡Šçš„å…ƒç´ å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼                     |

# æœ€ä½³å®è·µ

## å®è·µä»‹ç»

> æœ¬å®è·µä¸æ¶‰åŠæ•°æ®åº“é“¾æ¥

1. ç”¨æˆ·å®ä½“

   ```java
   package com.imxushuai.jsr303.entity;
   
   import lombok.Data;
   
   @Data
   public class User {
   
       /**
        * ID
        */
       private String id;
   
       /**
        * å§“å
        */
       private String name;
   
       /**
        * å¹´é¾„
        */
       private Integer age;
   
       /**
        * ä½å€
        */
       private String address;
   
   }
   ```

2. ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å¯¹è±¡ä½œä¸ºé€šç”¨æ¥å£è¿”å›å¯¹è±¡

   ```java
   package com.imxushuai.jsr303.entity;
   
   import lombok.Data;
   
   @Data
   public class CustomerResult {
   
       private int code;
       private String msg;
       private Object data;
   
       public static CustomerResult result(int code, String msg) {
           CustomerResult customerResult = new CustomerResult();
           customerResult.setCode(code);
           customerResult.setMsg(msg);
           customerResult.setData(null);
   
           return customerResult;
       }
   
       public static CustomerResult result(int code, String msg, Object data) {
           CustomerResult customerResult = new CustomerResult();
           customerResult.setCode(code);
           customerResult.setMsg(msg);
           customerResult.setData(data);
   
           return customerResult;
       }
   
   }
   
   ```

3. Jsr303TestControllerï¼ŒControllerä¸­æä¾›ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ–°å¢æ–¹æ³•ï¼Œä¸€ä¸ªä¿å­˜æ–¹æ³•

   ```java
   package com.imxushuai.jsr303.controller;
   
   import com.imxushuai.jsr303.entity.CustomerResult;
   import com.imxushuai.jsr303.entity.User;
   import com.imxushuai.jsr303.service.UserService;
   import org.springframework.beans.factory.annotation.Autowired;
   import org.springframework.http.ResponseEntity;
   import org.springframework.web.bind.annotation.PostMapping;
   import org.springframework.web.bind.annotation.RequestBody;
   import org.springframework.web.bind.annotation.RequestMapping;
   import org.springframework.web.bind.annotation.RestController;
   
   @RestController
   @RequestMapping("api/user")
   public class Jsr303TestController {
   
       @Autowired
       private UserService userService;
   
       @PostMapping("save")
       public ResponseEntity<CustomerResult> save(@RequestBody User user) {
           // ä¿å­˜æ•°æ®
           userService.save(user);
   
           return ResponseEntity.ok().;
       }
   
       @PostMapping("update")
       public ResponseEntity<CustomerResult> update(@RequestBody User user) {
           // æ›´æ–°æ•°æ®
           userService.update(user);
   
           return ResponseEntity.ok().build();
       }
   
   }
   ```

4. UserServiceï¼Œä»…å£°æ˜æ–¹æ³•å¹¶æ‰“å°äº†æ—¥å¿—ï¼Œä¸åšå…·ä½“çš„ä¸šåŠ¡æ“ä½œ

   ```java
   package com.imxushuai.jsr303.service;
   
   import com.imxushuai.jsr303.entity.User;
   import lombok.extern.slf4j.Slf4j;
   import org.springframework.stereotype.Service;
   
   @Slf4j
   @Service
   public class UserService {
       public void save(User user) {
           log.info("ç”¨æˆ·æ–°å¢æˆåŠŸ.....");
       }
   
       public void update(User user) {
           log.info("ç”¨æˆ·æ›´æ–°æˆåŠŸ.....");
       }
   }
   ```

5. pom.xml

   ```xml
   <?xml version="1.0" encoding="UTF-8"?>
   <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
       <modelVersion>4.0.0</modelVersion>
       <parent>
           <groupId>org.springframework.boot</groupId>
           <artifactId>spring-boot-starter-parent</artifactId>
           <version>2.1.8.RELEASE</version>
           <relativePath/> <!-- lookup parent from repository -->
       </parent>
       <groupId>com.imxushuai</groupId>
       <artifactId>jsr-303-demo</artifactId>
       <version>1.0-SNAPSHOT</version>
       <name>jsr-303-demo</name>
       <description>JSR-303æ ¡éªŒ</description>
       <properties>
           <java.version>1.8</java.version>
       </properties>
       <dependencies>
           <dependency>
               <groupId>org.springframework.boot</groupId>
               <artifactId>spring-boot-starter-web</artifactId>
           </dependency>
   
           <dependency>
               <groupId>org.springframework.boot</groupId>
               <artifactId>spring-boot-starter-test</artifactId>
               <scope>test</scope>
           </dependency>
   
           <dependency>
               <groupId>org.projectlombok</groupId>
               <artifactId>lombok</artifactId>
               <version>1.18.22</version>
           </dependency>
   
           <dependency>
               <groupId>org.apache.commons</groupId>
               <artifactId>commons-lang3</artifactId>
               <version>3.12.0</version>
           </dependency>
   
           <dependency>
               <groupId>javax.validation</groupId>
               <artifactId>validation-api</artifactId>
               <version>2.0.1.Final</version>
           </dependency>
       </dependencies>
   
       <build>
           <plugins>
               <plugin>
                   <groupId>org.springframework.boot</groupId>
                   <artifactId>spring-boot-maven-plugin</artifactId>
               </plugin>
           </plugins>
       </build>
   
   </project>
   ```

   

## åŸå§‹çš„æ ¡éªŒæ–¹æ³•

1. å¦‚æ–°å¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ ¡éªŒç”¨æˆ·åç§°å’Œå¹´é¾„ä¸ä¸ºç©ºæ—¶ï¼Œå¿…é¡»è¿›è¡Œç¼–ç æ¥å®Œæˆæ ¡éªŒå·¥ä½œ

   ```java
       @PostMapping("save")
       public ResponseEntity<CustomerResult> save(@RequestBody User user) {
           if (StringUtils.isBlank(user.getName())) {
               return ResponseEntity.ok().body(CustomerResult.result(400, "ç”¨æˆ·å§“åä¸èƒ½ä¸ºç©º!"));
           }
           if (user.getAge() == null || user.getAge() < 0) {
               return ResponseEntity.ok().body(CustomerResult.result(400, "ç”¨æˆ·å¹´é¾„ä¸èƒ½ä¸ºç©ºä¸”ä¸èƒ½å°äº0!"));
           }
           // ä¿å­˜æ•°æ®
           userService.save(user);
   
           return ResponseEntity.ok(CustomerResult.result(200, "æ–°å¢æˆåŠŸ"));
       }
   ```

2. æµ‹è¯•API

   å½“ç”¨æˆ·åä¸ºç©ºæ—¶ï¼Œæ­£ç¡®è¿”å›äº†æç¤ºä¿¡æ¯

   ![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/20211216203900.png)

æƒ³æƒ³çœ‹ï¼Œå¦‚æœæ›´æ–°çš„æ—¶å€™ä¹Ÿéœ€è¦åˆ¤æ–­ç”¨æˆ·åä¸ºç©ºçš„æƒ…å†µä¸å…è®¸ä¿å­˜ï¼Œæ˜¯å¦åŒæ ·çš„åˆ¤æ–­æœ‰éœ€è¦å†™ä¸€éï¼Œè¿™æ ·ä¼šå¤§å¤§çš„å¢åŠ äº†å·¥ä½œé‡ã€‚

ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä½¿ç”¨ Bean Validationæ¥å®Œæˆæ ¡éªŒ

## åŸºæœ¬ä½¿ç”¨

1. æ ¹æ®éœ€æ±‚åœ¨å®ä½“ç±»ä¸Šæ·»åŠ éœ€è¦çš„æ³¨è§£æ ‡æ³¨å…¶å­—æ®µéœ€è¦è¿›è¡Œæ ¡éªŒçš„è§„åˆ™ï¼Œå¦‚ï¼š

   ç”¨æˆ·åï¼šä¸èƒ½ä¸ºç©º

   å¹´é¾„ï¼šä¸èƒ½ä¸ºç©ºä¸”éœ€è¦å¤§äº0

   ```java
       /**
        * å§“å
        */
       @NotBlank
       private String name;
   
       /**
        * å¹´é¾„
        */
       @NotNull
       @Min(value = 0)
       private Integer age;
   ```

   æ·»åŠ æ³¨è§£åçš„å®ä½“ç±»å­—æ®µ

   @NotBlankï¼šå­—æ®µå€¼è‡³å°‘æœ‰ä¸€ä¸ªæœ‰æ•ˆå­—ç¬¦

   @NotNullï¼šå­—æ®µå€¼ä¸èƒ½ä¸ºç©º

   @Minï¼šå­—æ®µæœ€å°å€¼ä¸º0å³ageå­—æ®µçš„å€¼å¿…é¡»å¤§äºç­‰äº0

   æ³¨æ„ï¼šæ·»åŠ çš„æ³¨è§£çš„åŒ…ä½äºï¼š`javax.validation.constraints`

2. åœ¨APIçš„å‚æ•°æ¥æ”¶å¤„åŠ ä¸Š`@Valid`æ³¨è§£ï¼Œè¡¨æ˜è¯¥å‚æ•°éœ€è¦è¿›è¡Œå‚æ•°æ ¡éªŒå¹¶ä¸”æ³¨é‡Šæ‰åˆšæ‰ç¼–å†™çš„æ ¡éªŒä»£ç 

   ```java
   	@PostMapping("save")
       public ResponseEntity<CustomerResult> save(@Valid @RequestBody User user) {
           /*if (StringUtils.isBlank(user.getName())) {
               return ResponseEntity.ok().body(CustomerResult.result(400, "ç”¨æˆ·å§“åä¸èƒ½ä¸ºç©º!"));
           }
           if (user.getAge() == null || user.getAge() < 0) {
               return ResponseEntity.ok().body(CustomerResult.result(400, "ç”¨æˆ·å¹´é¾„ä¸èƒ½ä¸ºç©ºä¸”ä¸èƒ½å°äº0!"));
           }*/
           // ä¿å­˜æ•°æ®
           userService.save(user);
   
           return ResponseEntity.ok(CustomerResult.result(200, "æ–°å¢æˆåŠŸ"));
       }
   ```

3. é‡å¯é¡¹ç›®è¿›è¡Œæµ‹è¯•

   ![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/20211216205315.png)

   è¿”å›å€¼ä¸­å¯ä»¥çœ‹åˆ°æç¤ºæ¶ˆæ¯ï¼šä¸èƒ½ä¸ºç©ºã€‚

   ä½†æ˜æ˜¾å¯ä»¥çœ‹å‡ºè¿™æ ·çš„è¿”å›æ ¼å¼æœ‰ç‚¹è¿‡äºéš¾ä»¥è¾¨åˆ«ï¼Œæ˜¯å¦èƒ½å¤Ÿè‡ªå®šä¹‰è¿”å›æ¶ˆæ¯ä»¥åŠè¿”å›çš„æ ¼å¼å‘¢ï¼Ÿ

4. è‡ªå®šä¹‰è¿”å›çš„æ¶ˆæ¯å’Œæ ¼å¼

   - è‡ªå®šä¹‰æ¶ˆæ¯

     ```java
         /**
          * å§“å
          */
         @NotBlank(message = "ç”¨æˆ·å§“åä¸èƒ½ä¸ºç©º")
         private String name;
     
         /**
          * å¹´é¾„
          */
         @NotNull(message = "ç”¨æˆ·å¹´é¾„ä¸èƒ½ä¸ºç©º")
         @Min(value = 0, message = "ç”¨æˆ·å¹´é¾„å¿…é¡»å¤§äºç­‰äº0")
         private Integer age;
     ```

   - è‡ªå®šä¹‰æ ¼å¼

     å¯ä»¥åœ¨Controllerçš„å‚æ•°ä¸­å£°æ˜`BindResult`ç±»å‹çš„å‚æ•°ï¼Œæ­¤å‚æ•°å¯ä»¥æ¥æ”¶åˆ°å‚æ•°æ ¡éªŒçš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ä»æ­¤å‚æ•°ä¸­è·å–åˆ°æ ¡éªŒçš„ç»“æœå¹¶å¤„ç†åè¿”å›

     ```java
     @PostMapping("save")
         public ResponseEntity<CustomerResult> save(@Valid @RequestBody User user, BindingResult result) {
             /*if (StringUtils.isBlank(user.getName())) {
                 return ResponseEntity.ok().body(CustomerResult.result(400, "ç”¨æˆ·å§“åä¸èƒ½ä¸ºç©º!"));
             }
             if (user.getAge() == null || user.getAge() < 0) {
                 return ResponseEntity.ok().body(CustomerResult.result(400, "ç”¨æˆ·å¹´é¾„ä¸èƒ½ä¸ºç©ºä¸”ä¸èƒ½å°äº0!"));
             }*/
             if (result.hasErrors()) {
                 Map<String, String> map = new HashMap<>();
                 // è·å–é”™è¯¯çš„æ ¡éªŒç»“æœ
                 result.getFieldErrors().forEach((item) -> {
                     // è·å–å‘ç”Ÿé”™è¯¯æ—¶çš„message
                     String message = item.getDefaultMessage();
                     // è·å–å‘ç”Ÿé”™è¯¯çš„å­—æ®µ
                     String field = item.getField();
                     map.put(field, message);
                 });
                 return ResponseEntity.ok(CustomerResult.result(400, "æ–°å¢å¤±è´¥", map));
             }
             // ä¿å­˜æ•°æ®
             userService.save(user);
     
             return ResponseEntity.ok(CustomerResult.result(200, "æ–°å¢æˆåŠŸ"));
         }
     ```

5. é‡å¯æœåŠ¡ï¼Œæµ‹è¯•API

   å¯ä»¥çœ‹åˆ°è¿”å›çš„ç»“æœå¾ˆç†æƒ³ï¼Œé”™è¯¯çš„å­—æ®µæ˜¯nameï¼Œæç¤ºä¿¡æ¯ä¸ºç”¨æˆ·å§“åä¸èƒ½ä¸ºç©º

   ![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/20211216232249.png)

   å¹´é¾„å­—æ®µæˆ‘å°±ä¸æµ‹è¯•äº†ã€‚

## ç»Ÿä¸€å¼‚å¸¸å¤„ç†

> ä¸Šé¢è®²äº†åŸºæœ¬çš„æ ¡éªŒä½¿ç”¨ï¼Œè¿˜æ˜¯ä¼šå‘ç°ï¼Œå…¶å®æˆ‘ä»¬è¿˜æ˜¯åœ¨APIä¸­è¿›è¡Œäº†ä¸€ç³»åˆ—çš„ç¼–ç ï¼Œ è¿˜æ˜¯æ²¡æœ‰åšåˆ°ä»£ç çš„å¤ç”¨æ€§ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æ¥å®Œæˆæ ¡éªŒå¤±è´¥çš„ç»“æœç»Ÿä¸€è¿”å›ã€‚

1. å®šä¹‰ç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±»

   åˆ›å»ºçš„ç±»ä¸»è¦éœ€è¦ä½¿ç”¨`@RestControllerAdvice`è¿›è¡Œæ ‡æ³¨

   ```java
   package com.imxushuai.jsr303.exception;
   
   import com.imxushuai.jsr303.entity.CustomerResult;
   import org.springframework.http.ResponseEntity;
   import org.springframework.validation.BindingResult;
   import org.springframework.web.bind.MethodArgumentNotValidException;
   import org.springframework.web.bind.annotation.ExceptionHandler;
   import org.springframework.web.bind.annotation.RestControllerAdvice;
   
   import java.util.HashMap;
   import java.util.Map;
   
   /**
    * ç»Ÿä¸€å¼‚å¸¸å¤„ç†
    */
   @RestControllerAdvice
   public class Jsr303ExceptionControllerAdvice {
   
       /**
        * MethodArgumentNotValidExceptionå¼‚å¸¸ç»Ÿä¸€å¤„ç†
        * ä»…å¤„ç†MethodArgumentNotValidExceptionå¼‚å¸¸
        *
        * @param exception MethodArgumentNotValidException
        * @return å¼‚å¸¸è¿”å›
        */
       @ExceptionHandler(value = MethodArgumentNotValidException.class)
       public ResponseEntity<CustomerResult> handleValidException(MethodArgumentNotValidException exception) {
           Map<String, String> map = new HashMap<>();
           BindingResult bindingResult = exception.getBindingResult();
           bindingResult.getFieldErrors().forEach(fieldError -> {
               String message = fieldError.getDefaultMessage();
               String field = fieldError.getField();
               map.put(field, message);
           });
   
           return ResponseEntity.ok().body(CustomerResult.result(400, "å‚æ•°å¼‚å¸¸", map));
       }
   
       /**
        * é€šç”¨å¼‚å¸¸å¤„ç†
        *
        * @param throwable å¼‚å¸¸
        * @return å¼‚å¸¸è¿”å›
        */
       @ExceptionHandler(value = Throwable.class)
       public ResponseEntity<CustomerResult> handleException(Throwable throwable) {
           return ResponseEntity.ok().body(CustomerResult.result(500, "æœªçŸ¥å¼‚å¸¸"));
       }
   
   }
   ```

2. æ³¨é‡Šæ‰åœ¨controllerä¸­çš„ä»£ç å¹¶ä¸”åˆ é™¤å‚æ•°ä¸­æ¥æ”¶åˆ°`BindResult`å‚æ•°

3. é‡å¯æœåŠ¡è¿›è¡Œæµ‹è¯•

   æµ‹è¯•ä¾ç„¶æœ‰æ•ˆ

   ![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/20211216234110.png)

   æˆ‘ä»¬å†æµ‹è¯•ä¸€ä¸‹æ›´æ–°API

   æ³¨æ„ï¼šæµ‹è¯•ä¹‹å‰éœ€è¦åœ¨updateçš„å‚æ•°ä¸Šä½¿ç”¨`@Valid`æ³¨è§£è¿›è¡Œæ ‡æ³¨ï¼Œå¦åˆ™å‚æ•°æ ¡éªŒä¸ä¼šç”Ÿæ•ˆ

   ![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/20211216234438.png)

   ä¾ç„¶ç”Ÿæ•ˆã€‚

## åˆ†ç»„æ ¡éªŒ

> ä¸Šé¢å·²ç»åŸºæœ¬å®Œæˆäº†å‚æ•°æ ¡éªŒçš„å¸¸è§„ä½¿ç”¨ï¼Œä¸‹é¢ä»‹ç»ä¸€ç§è¿›é˜¶ç”¨æ³•ã€‚åœºæ™¯å¦‚ä¸‹ï¼š
>
> æ–°å¢æ—¶ï¼ŒIDå‚æ•°ä¸ºç©ºï¼Œåç§°ä¸ä¸ºç©ºï¼Œå¹´é¾„ä¸ä¸ºç©ºä¸”å¤§äºç­‰äº0
>
> æ›´æ–°æ—¶ï¼ŒIDå‚æ•°ä¸ä¸ºç©ºï¼Œåç§°ä¸ä¸ºç©ºï¼Œå¹´é¾„ä¸ä¸ºç©ºä¸”å¤§äºç­‰äº0
>
> è¿™ç§æƒ…å†µï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­æ˜¯æ— æ³•å»åˆ¤æ–­IDå‚æ•°çš„ã€‚
>
> è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨åˆ†ç»„æ ¡éªŒæ¥å®Œæˆæƒ³è¦çš„æ•ˆæœã€‚

1. é¦–å…ˆéœ€è¦å£°æ˜ä¸¤ä¸ªç±»ï¼Œç”¨æ¥è¡¨ç¤ºæ–°å¢ç»„å’Œæ›´æ–°ç»„ã€‚ï¼ˆåªä½œæ¥å£ç±»å£°æ˜ï¼Œä¸éœ€è¦ç¼–ç ï¼‰

   - AddGroup

     ```java
     package com.imxushuai.jsr303.valid;
     
     public interface AddGroup {
     }
     ```

   - UpdateGroup

     ```java
     package com.imxushuai.jsr303.valid;
     
     public interface UpdateGroup {
     }
     ```

2. åœ¨å®ä½“ç±»ä¸­å¯¹å‚æ•°è¿›è¡Œåˆ†ç»„

   ä½¿ç”¨æ³¨è§£ä¸­çš„`groups`å‚æ•°ç”¨æ¥è¡¨ç¤ºå½“å‰æ³¨è§£é€‚ç”¨äºå“ªäº›åˆ†ç»„

   ```java
   package com.imxushuai.jsr303.entity;
   
   import com.imxushuai.jsr303.valid.AddGroup;
   import com.imxushuai.jsr303.valid.UpdateGroup;
   import lombok.Data;
   
   import javax.validation.constraints.Min;
   import javax.validation.constraints.NotBlank;
   import javax.validation.constraints.NotNull;
   import javax.validation.constraints.Null;
   
   @Data
   public class User {
   
       /**
        * ID
        */
       @Null(message = "æ–°å¢æ—¶, IDå¿…é¡»ä¸ºç©º", groups = {AddGroup.class})
       @NotNull(message = "æ›´æ–°æ—¶, IDä¸èƒ½ä¸ºç©º", groups = {UpdateGroup.class})
       private String id;
   
       /**
        * å§“å
        */
       @NotBlank(message = "ç”¨æˆ·å§“åä¸èƒ½ä¸ºç©º", groups = {AddGroup.class, UpdateGroup.class})
       private String name;
   
       /**
        * å¹´é¾„
        */
       @NotNull(message = "ç”¨æˆ·å¹´é¾„ä¸èƒ½ä¸ºç©º", groups = {AddGroup.class, UpdateGroup.class})
       @Min(value = 0, message = "ç”¨æˆ·å¹´é¾„å¿…é¡»å¤§äºç­‰äº0", groups = {AddGroup.class, UpdateGroup.class})
       private Integer age;
   
       /**
        * ä½å€
        */
       private String address;
   
   }
   ```

3. åœ¨controllerçš„APIå‚æ•°ä¸Šä½¿ç”¨è¯¥åˆ†ç»„æ¥è¡¨ç¤ºå½“å‰APIé€‚ç”¨äºå“ªä¸ªåˆ†ç»„

   ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯`@Valid`æ³¨è§£ï¼Œè¦ä½¿ç”¨åˆ†ç»„æ ¡éªŒçš„ç‰¹æ€§éœ€è¦æ›´æ¢æ³¨è§£ï¼Œä½¿ç”¨`@Validated`å¹¶åœ¨æ³¨è§£çš„å‚æ•°ä¸­æ ‡æ³¨å…¶ä½¿ç”¨çš„æ ¡éªŒåˆ†ç»„ï¼Œå¦‚ï¼š`@Validated({AddGroup.class})`

   ![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/20211216235531.png)

   updateçš„APIåˆ™ä½¿ç”¨`@Validated({UpdateGroup.class})`

4. é‡å¯æœåŠ¡è¿›è¡Œæµ‹è¯•

   ![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/20211216235733.png)

   æ–°å¢æ—¶ä¼ å…¥äº†IDå‚æ•°ï¼Œè¿”å›çš„ç»“æœå’Œç†æƒ³çš„ä¸€è‡´ã€‚æ›´æ–°çš„æƒ…å†µï¼Œæˆ‘å°±ä¸æµ‹è¯•äº†ã€‚

**æ³¨æ„ï¼šåŠ äº†æ ¡éªŒåˆ†ç»„åï¼Œæ²¡æœ‰æ ¡éªŒåˆ†ç»„çš„å­—æ®µå°†ä¸ä¼šå‚ä¸å£°æ˜äº†åˆ†ç»„æ ¡éªŒçš„APIå‚æ•°æ ¡éªŒ**

## è‡ªå®šä¹‰æ ¡éªŒ

> ä¸Šé¢è®²äº†åˆ†ç»„æ ¡éªŒçš„åŠæ³•ï¼Œæ¥ä¸‹æ¥ä»‹ç»å¦ä¸€ç§æƒ…å†µï¼Œæ¯”å¦‚ç”¨æˆ·æœ‰ä¸€ä¸ªå±æ€§ï¼šæ€§åˆ«ï¼Œå…¶å€¼åªèƒ½ä¸º0æˆ–è€…1ï¼Œ0æ˜¯ç”·æ€§ï¼Œ1æ˜¯å¥³æ€§ï¼Œ2æ˜¯æœªçŸ¥ï¼›éœ€è¦æ ¡éªŒä¼ é€’çš„å‚æ•°å¿…é¡»ä¸º0ï¼Œ1ï¼Œ2ä¸‰ä¸ªå€¼ä¸­çš„ä¸€ç§ï¼Œè¿™æ—¶ä½¿ç”¨å†…ç½®çš„æ ¡éªŒæ³¨è§£å·²ç»æ²¡æœ‰åŠæ³•æ»¡è¶³è¿™ä¸ªéœ€æ±‚äº†ã€‚
>
> è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨åˆ°è‡ªå®šä¹‰æ³¨è§£æ¥å®Œæˆè¿™é¡¹æ“ä½œã€‚

1. åœ¨ç”¨æˆ·å®ä½“ç±»ä¸­æ–°å¢æ€§åˆ«å­—æ®µ

   ```java
       /**
        * æ€§åˆ«ï¼Œ0ï¼šç”·æ€§ï¼›1ï¼šå¥³æ€§ï¼›2ï¼šæœªçŸ¥
        */
       private Integer gender;
   ```

2. åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰æ³¨è§£

   ```java
   package com.imxushuai.jsr303.valid;
   
   import javax.validation.Constraint;
   import java.lang.annotation.Documented;
   import java.lang.annotation.Retention;
   import java.lang.annotation.Target;
   
   import static java.lang.annotation.ElementType.*;
   import static java.lang.annotation.RetentionPolicy.RUNTIME;
   
   @Documented
   @Constraint(validatedBy = {ListValueConstraintValidator.class})
   @Target({METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE})
   @Retention(RUNTIME)
   public @interface ListValue {
   
       String message() default "å¿…é¡»æäº¤æŒ‡å®šçš„å€¼";
   
       Class[] groups() default {};
   
       Class[] payload() default {};
   
       int[] values() default {};
   
   }
   ```

   ç±»ä¸­æœ€å…³é”®çš„ç‚¹åœ¨äºç±»ä¸Šçš„`@Constraint(validatedBy = {ListValueConstraintValidator.class})`æ³¨è§£ï¼Œè¿™é‡Œå£°æ˜äº†è¯¥æ³¨è§£çš„æ ¡éªŒå™¨ç±»ä¸ºï¼š`ListValueConstraintValidator.class`ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªæ ¡éªŒå™¨ç±»ï¼Œè¯¥ç±»ç”¨äºç¼–ç å®Œæˆæ ¡éªŒé€»è¾‘ã€‚

   æ³¨è§£çš„å‚æ•°ï¼š

   - messageï¼šæ ¡éªŒå¤±è´¥çš„è¿”å›å€¼
   - groupsï¼šåˆ†ç»„æ ¡éªŒ
   - valuesï¼šè‡ªå®šä¹‰çš„å­—æ®µï¼Œç”¨äºå­˜æ”¾å­—æ®µå¯èƒ½çš„å€¼çš„åˆ—è¡¨ï¼Œæ¯”å¦‚æ€§åˆ«ï¼š{1, 2, 3}

3. ç¼–å†™æ ¡éªŒå™¨ç±»

   ```java
   package com.imxushuai.jsr303.valid;
   
   import javax.validation.ConstraintValidator;
   import javax.validation.ConstraintValidatorContext;
   import java.util.HashSet;
   import java.util.Set;
   
   public class ListValueConstraintValidator implements ConstraintValidator<ListValue, Integer> {
   
       private Set<Integer> set = new HashSet<>();
   
       @Override
       public void initialize(ListValue constraintAnnotation) {
           int[] values = constraintAnnotation.values();
   
           for (int value : values) {
               set.add(value);
           }
   
       }
   
       @Override
       public boolean isValid(Integer value, ConstraintValidatorContext constraintValidatorContext) {
           // æ ¡éªŒå€¼æ˜¯å¦æ˜¯
           return set.contains(value);
       }
   }
   ```

4. åœ¨å®ä½“ç±»çš„æ€§åˆ«å­—æ®µä¸Šæ·»åŠ æ³¨è§£

   ```java
       /**
        * æ€§åˆ«ï¼Œ0ï¼šç”·æ€§ï¼›1ï¼šå¥³æ€§ï¼›2ï¼šæœªçŸ¥
        */
       @ListValue(values = {1, 2, 3})
       private Integer gender;
   ```

5. é‡å¯æœåŠ¡ï¼Œæµ‹è¯•API

   ![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/20211217000913.png)

   å¼‚å¸¸æ ¡éªŒæŒ‰ç…§é¢„æœŸè¿”å›ã€‚

**æ³¨æ„ï¼šè‡ªå®šä¹‰çš„æ ¡éªŒæ³¨è§£ï¼ŒåŒåæ³¨è§£å¯ä»¥æœ‰å¤šä¸ªï¼Œä¸»è¦ç”¨äºå¤šç±»å‹çš„å‚æ•°æ ¡éªŒã€‚**

**æ¯”å¦‚ï¼šAç³»ç»Ÿçš„ç”·æ€§å¥³æ€§ä½¿ç”¨çš„æ•°å­—1ï¼Œ2ï¼›è€ŒBç³»ç»Ÿçš„ç”·æ€§å¥³æ€§ä½¿ç”¨çš„æ˜¯å­—ç¬¦ä¸²çš„1ï¼Œ2ï¼›æ­¤æƒ…å†µå°±å¯ä»¥ä½¿ç”¨å†å£°æ˜ä¸€ä¸ªåŒåæ³¨è§£ï¼Œå…¶valuesçš„å€¼æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œç„¶åç¼–å†™å‚æ•°æ ¡éªŒå™¨å³å¯å®Œæˆã€‚**

# ä»£ç è·å–

å®Œæ•´çš„ä»£ç è·å–ï¼šğŸ‘‰[JSR-303-Demo](https://github.com/imxushuai/Demo-Repository)ğŸ‘ˆ

æ­¤é¡¹ç›®ä¸ºæˆ‘ä¸ªäººçš„Demoåˆé›†ï¼Œæœ¬æ–‡ç« ä»‹ç»çš„å†…å®¹çš„ç›®å½•å¦‚å›¾ï¼š

![](https://imxushuai-blog.oss-cn-chengdu.aliyuncs.com/20211217001512.png)