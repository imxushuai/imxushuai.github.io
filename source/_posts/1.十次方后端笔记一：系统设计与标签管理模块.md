---
title: åæ¬¡æ–¹åç«¯ç¬”è®°ä¸€ï¼šç³»ç»Ÿè®¾è®¡ä¸æ ‡ç­¾ç®¡ç†æ¨¡å—
tags:
  - åæ¬¡æ–¹ç³»ç»Ÿæ­å»º
  - åæ¬¡æ–¹é¡¹ç›®ç³»ç»Ÿè®¾è®¡
  - åæ¬¡æ–¹é¡¹ç›®åŸºç¡€æ¨¡å—
categories:
  - åæ¬¡æ–¹é¡¹ç›®
abbrlink: 57879
date: 2002-01-02 00:00:01
---

<center><i>åæ¬¡æ–¹é¡¹ç›®æ­å»ºã€ç³»ç»Ÿä»‹ç»å’ŒåŸºç¡€å¾®æœåŠ¡æ­å»º</i></center>

![](https://dev.tencent.com/u/imxushuai/p/pic/git/raw/master/tensquare.jpg)

<!-- more -->

> ã€Šåæ¬¡æ–¹ã€‹æ˜¯ç¨‹åºå‘˜çš„ä¸“å±ç¤¾äº¤å¹³å°ï¼ŒåŒ…æ‹¬å¤´æ¡ã€é—®ç­”ã€æ´»åŠ¨ã€äº¤å‹ã€åæ§½ã€æ‹›è˜å…­å¤§
> é¢‘é“ã€‚

# ç³»ç»Ÿè®¾è®¡

ã€Šåæ¬¡æ–¹ã€‹é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„ç³»ç»Ÿæ¶æ„ï¼Œåç«¯æ¶æ„ä¸ºï¼š
SpringBoot+SpringCloud+SpringMVC+SpringData  æˆ‘ä»¬æŠŠè¿™ç§æ¶æ„ä¹Ÿç§°ä¹‹ä¸ºå…¨å®¶æ¡¶ã€‚

## æ¨¡å—åˆ’åˆ†

åæ¬¡æ–¹å·¥ç¨‹å…±åˆ†ä¸º18ä¸ªå­æ¨¡å—ï¼ˆå…¶ä¸­17ä¸ªæ˜¯å¾®æœåŠ¡ï¼‰

| æ¨¡å—åç§°                  | æ¨¡å—ä¸­æ–‡åç§°   |
| ------------------------- | -------------- |
| tensquare_common          | å…¬å…±æ¨¡å—       |
| tensquare_article         | æ–‡ç« å¾®æœåŠ¡     |
| tensquare_base            | åŸºç¡€å¾®æœåŠ¡     |
| tensquare_friend          | äº¤å‹å¾®æœåŠ¡     |
| tensquare_gathering       | æ´»åŠ¨å¾®æœåŠ¡     |
| tensquare_qa              | é—®ç­”å¾®æœåŠ¡     |
| tensquare_recruit         | æ‹›è˜å¾®æœåŠ¡     |
| tensquare_user            | ç”¨æˆ·å¾®æœåŠ¡     |
| tensquare_spit            | åæ§½å¾®æœåŠ¡     |
| tensquare_search          | æœç´¢å¾®æœåŠ¡     |
| tensquare_web             | å‰å°å¾®æœåŠ¡ç½‘å…³ |
| tensquare_manager         | åå°å¾®æœåŠ¡ç½‘å…³ |
| tensquare_eureka          | æ³¨å†Œä¸­å¿ƒ       |
| tensquare_config          | é…ç½®ä¸­å¿ƒ       |
| tensquare_sms             | çŸ­ä¿¡å¾®æœåŠ¡     |
| tensquare_article_crawler | æ–‡ç« çˆ¬è™«å¾®æœåŠ¡ |
| tensquare_user_crawler    | ç”¨æˆ·çˆ¬è™«å¾®æœåŠ¡ |
| tensquare_ai              | äººå·¥æ™ºèƒ½å¾®æœåŠ¡ |

## åç«¯çŠ¶æ€ç å®šä¹‰

| çŠ¶æ€æè¿°       | è¿”å›ç  |
| -------------- | ------ |
| æˆåŠŸ           | 20000  |
| å¤±è´¥           | 20001  |
| ç”¨æˆ·åå¯†ç é”™è¯¯ | 20002  |
| æƒé™ä¸è¶³       | 20003  |
| è¿œç¨‹è°ƒç”¨å¤±è´¥   | 20004  |
| é‡å¤æ“ä½œ       | 20005  |

# é¡¹ç›®å‡†å¤‡

VMware Workstation Pro

CentOS 7é•œåƒ

## å®‰è£…CentOS 7ï¼ˆçœç•¥ï¼‰

## CentOS 7å®‰è£…docker

å®‰è£…`docker`éœ€è¦ä¿è¯ä½ çš„`CentOS 7`èƒ½å¤Ÿè¿æ¥åˆ°äº’è”ç½‘ï¼Œå¯ä»¥åœ¨è™šæ‹Ÿæœºä¸­ä½¿ç”¨`ping`å‘½ä»¤ã€‚

```shell
ping baidu.com
```

1. é€šè¿‡ **uname -r** å‘½ä»¤æŸ¥çœ‹ä½ å½“å‰çš„å†…æ ¸ç‰ˆæœ¬

   ```shell
   uname -r # å¤§äºç­‰äº3.10å³å¯
   ```

2. ç§»é™¤æ—§çš„ç‰ˆæœ¬docker

   ```java
   yum remove docker \
                     docker-client \
                     docker-client-latest \
                     docker-common \
                     docker-latest \
                     docker-latest-logrotate \
                     docker-logrotate \
                     docker-selinux \
                     docker-engine-selinux \
                     docker-engine
   ```

3. å®‰è£…ä¾èµ–

   ```shell
   yum install -y yum-utils device-mapper-persistent-data lvm2
   ```

4. å¢åŠ `yum`æº

   ```shell
   yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
   ```

5. æ›´æ–°`yum`ç¼“å­˜

   ```shell
   yum makecache fast
   ```

6. å®‰è£… `Docker-ce`ï¼Œ`ce`ä¸ºç¤¾åŒºç‰ˆï¼Œ`ee`ä¸ºä¼ä¸šç‰ˆï¼Œä½†æ˜¯è¦æ”¶è´¹ğŸ¤¦â€

   ```shell
   yum -y install docker-ce
   ```

7. å¯åŠ¨ `Docker` åå°æœåŠ¡

   ```shell
   systemctl start docker
   ```

8. æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ

   ```shell
   docker -version
   ```

   ![](https://dev.tencent.com/u/imxushuai/p/pic/git/raw/master/20190605203729.png)

   

## å®‰è£…MySQLé•œåƒ

1. æœç´¢`mysql`é•œåƒ

   ```shell
   docker search mysql
   ```

   ![](https://dev.tencent.com/u/imxushuai/p/pic/git/raw/master/20190605203846.png)

2. æ‹‰å–`mysql`é•œåƒ

   ```shell
   # è¿™é‡Œæ‹‰å–centosæä¾›çš„mysqlé•œåƒï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šéå¸¸çš„ç¼“æ…¢
   # å®åœ¨ä¸è¡Œå°±ç”¨äººå®¶æä¾›å¥½çš„centosé•œåƒå§
   docker pull centos/mysqlâ€57â€centos7
   ```

   CentOSæä¾›çš„é•œåƒé›†åˆï¼š[docker hub](<https://hub.docker.com/u/centos>)

    ä¼šä»‹ç»æ¯ä¸€ä¸ªå®¹å™¨çš„ä½¿ç”¨æ–¹æ³•ï¼Œå»ºè®®æµè§ˆï¼Œä½†æ˜¯æ˜¯è‹±æ–‡çš„ï¼ˆå³é”® -> è°·æ­Œç¿»è¯‘ o(ï¿£â–½ï¿£)ï½„ï¼‰ã€‚

3. è¿è¡Œ`mysql`é•œåƒ

   ```shell
   # æŸ¥çœ‹æœ¬åœ°é•œåƒ
   docker images
   # å®‰è£…mysqlé•œåƒ
   dockerÂ runÂ â€diÂ â€â€name=tensquare_mysqlÂ â€pÂ 3306:3306Â â€eÂ MYSQL_ROOT_PASSWORD=123456Â Â centos/mysqlâ€57â€centos7
   ```

4. ä½¿ç”¨`æ•°æ®åº“ç•Œé¢å·¥å…·`è¿æ¥`mysql`

   ![](https://dev.tencent.com/u/imxushuai/p/pic/git/raw/master/20190605204642.png
   https://dev.tencent.com/u/imxushuai/p/pic/git/raw/master/20190605204642.png)

## å»ºåº“å»ºè¡¨ï¼ˆçœç•¥ï¼‰

# é¡¹ç›®æ­å»º

## çˆ¶å·¥ç¨‹æ­å»º

### åˆ›å»ºmodule

- GroupIdï¼š`com.tensquare`
- ArtifactIdï¼š`tensquare_parent`

### pom.xmlä¾èµ–

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.tensquare</groupId>
    <artifactId>tensquare_parent</artifactId>
    <packaging>pom</packaging>
    <version>1.0.0-SNAPSHOT</version>

    <description>åæ¬¡æ–¹é¡¹ç›®</description>
    <modules>
        <module>tensquare_common</module>
    </modules>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.0.1.RELEASE</version>
        <relativePath/>
    </parent>

    <properties>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
        <java.version>1.8</java.version>
        <tensquare.version>1.0.0-SNAPSHOT</tensquare.version>
    </properties>

    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
        </dependency>
    </dependencies>

    <repositories>
        <repository>
            <id>spring-snapshots</id>
            <name>Spring Snapshots</name>
            <url>https://repo.spring.io/snapshot</url>
            <snapshots>
                <enabled>true</enabled>
            </snapshots>
        </repository>
        <repository>
            <id>spring-milestones</id>
            <name>Spring Milestones</name>
            <url>https://repo.spring.io/milestone</url>
            <snapshots>
                <enabled>false</enabled>
            </snapshots>
        </repository>
    </repositories>

    <pluginRepositories>
        <pluginRepository>
            <id>spring-snapshots</id>
            <name>Spring Snapshots</name>
            <url>https://repo.spring.io/snapshot</url>
            <snapshots>
                <enabled>true</enabled>
            </snapshots>
        </pluginRepository>
        <pluginRepository>
            <id>spring-milestones</id>
            <name>Spring Milestones</name>
            <url>https://repo.spring.io/milestone</url>
            <snapshots>
                <enabled>false</enabled>
            </snapshots>
        </pluginRepository>
    </pluginRepositories>
</project>
```

## å…¬å…±æ¨¡å—æ­å»º

### åˆ›å»ºmodule

- GroupIdï¼š`com.tensquare`
- ArtifactIdï¼š`tensquare_common`

### å®ä½“ç±»

1. é€šç”¨è¿”å›ç»“æœå®ä½“ç±»

   ```java
   package entity;
   
   import lombok.AllArgsConstructor;
   import lombok.Data;
   import lombok.NoArgsConstructor;
   
   /**
    * ç»Ÿä¸€è¿”å›ç»“æœå¯¹è±¡
    */
   @Data
   @AllArgsConstructor
   @NoArgsConstructor
   public class Result {
   
       /**
        * çŠ¶æ€æ ‡è¯†
        */
       private boolean flag;
   
       /**
        * çŠ¶æ€ç 
        */
       private Integer code;
   
       /**
        * æç¤ºæ¶ˆæ¯
        */
       private String message;
   
       /**
        * æ•°æ®
        */
       private Object data;
   
       public Result(boolean flag, Integer code, String message) {
           this.flag = flag;
           this.code = code;
           this.message = message;
       }
   
   }
   ```

2. çŠ¶æ€ç æšä¸¾ç±»

   ```java
   package entity;
   
   import lombok.Getter;
   
   /**
    * çŠ¶æ€ç æšä¸¾ç±»
    */
   @Getter
   public enum StatusCode {
   
       OK(20000, "è¯·æ±‚æˆåŠŸ"),
       ERROR(20001, "è¯·æ±‚å¤±è´¥"),
       LOGIN_ERROR(20002, "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"),
       ACCESS_ERROR(20003, "æƒé™ä¸è¶³"),
       REMOTE_ERROR(20004, "è¿œç¨‹è°ƒç”¨å¤±è´¥"),
       REP_ERROR(20005, "é‡å¤æ“ä½œ"),
       ;
   
       private int statusCode;
       private String defaultMessage;
   
       StatusCode(int statusCode, String defaultMessage) {
           this.statusCode = statusCode;
           this.defaultMessage = defaultMessage;
       }
   }
   ```

3. åˆ†é¡µç»“æœå®ä½“ç±»

   ```java
   package entity;
   
   import lombok.AllArgsConstructor;
   import lombok.Data;
   import lombok.NoArgsConstructor;
   
   import java.util.List;
   
   @Data
   @NoArgsConstructor
   @AllArgsConstructor
   public class PageResult<T> {
   
       private Long total;
       private List<T> rows;
   
   }
   ```

### IDç”Ÿæˆå·¥å…·ç±»

ç”±äºæˆ‘ä»¬çš„æ•°æ®åº“åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¦åˆ†ç‰‡éƒ¨ç½²ï¼ˆMyCatï¼‰,æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨æ•°æ®åº“æœ¬èº«çš„è‡ªå¢åŠŸèƒ½æ¥äº§ç”Ÿä¸»é”®å€¼ï¼Œåªèƒ½ç”±ç¨‹åºæ¥ç”Ÿæˆå”¯ä¸€çš„ä¸»é”®å€¼ã€‚

æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯å¼€æºçš„`twitter`( éå®˜æ–¹ä¸­æ–‡æƒ¯ç§°ï¼šæ¨ç‰¹.æ˜¯å›½å¤–çš„ä¸€ä¸ªç½‘ç«™ï¼Œæ˜¯ä¸€ä¸ªç¤¾äº¤ç½‘ç»œåŠå¾®åšå®¢æœåŠ¡) çš„`snowflakeï¼ˆé›ªèŠ±ï¼‰`ç®—æ³•ã€‚

![](https://dev.tencent.com/u/imxushuai/p/pic/git/raw/master/snowflake.jpg)

# åŸºç¡€å¾®æœåŠ¡ï¼ˆtensquare_baseï¼‰

## æ ‡ç­¾ç®¡ç†ï¼ˆCRUDï¼‰

### è¡¨ç»“æ„åˆ†æ

| å­—æ®µåç§°  | å­—æ®µå«ä¹‰ | å­—æ®µç±»å‹ | å¤‡æ³¨             |
| --------- | -------- | -------- | ---------------- |
| id        | ID       | æ–‡æœ¬     |                  |
| labelname | æ ‡ç­¾åç§° | æ–‡æœ¬     |                  |
| state     | çŠ¶æ€     | æ–‡æœ¬     | 0ï¼šæ— æ•ˆ  1ï¼šæœ‰æ•ˆ |
| count     | ä½¿ç”¨æ•°é‡ | æ•´å‹     |                  |
| fans      | å…³æ³¨æ•°   | æ•´å‹     |                  |
| recommend | æ˜¯å¦æ¨è | æ–‡æœ¬     | 0ï¼šä¸æ¨è1:æ¨è  |

### å‡†å¤‡å·¥ä½œ

1. é¡¹ç›®æ­å»º

2. pom.xml

   ```xml
   <?xml version="1.0" encoding="UTF-8"?>
   <project xmlns="http://maven.apache.org/POM/4.0.0"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
       <parent>
           <artifactId>tensquare_parent</artifactId>
           <groupId>com.tensquare</groupId>
           <version>1.0.0-SNAPSHOT</version>
       </parent>
       <modelVersion>4.0.0</modelVersion>
   
       <artifactId>tensquare_base</artifactId>
   
       <dependencies>
           <dependency>
               <groupId>org.springframework.boot</groupId>
               <artifactId>spring-boot-starter-data-jpa</artifactId>
           </dependency>
           <dependency>
               <groupId>mysql</groupId>
               <artifactId>mysql-connector-java</artifactId>
           </dependency>
           <dependency>
               <groupId>com.tensquare</groupId>
               <artifactId>tensquare_common</artifactId>
               <version>${tensquare.version}</version>
           </dependency>
       </dependencies>
   
   </project>
   ```

3. å¯åŠ¨ç±»

   ```java
   package com.tensquare;
   
   import org.springframework.boot.SpringApplication;
   import org.springframework.boot.autoconfigure.SpringBootApplication;
   
   @SpringBootApplication
   public class BaseApplication {
       public static void main(String[] args) {
           SpringApplication.run(BaseApplication.class, args);
       }
   }
   ```

4. application.yaml

   ```yaml
   server:
     port: 9001
   spring:
     application:
       name: tensquare-base
     datasource:
       driverClassName: com.mysql.jdbc.Driver
       url: jdbc:mysql://192.168.136.104:3306/tensquare_base?characterEncoding=utf8
       username: root
       password: 123456
     jpa:
       database: MySQL
       showâ€sql: true
       generateâ€ddl: true
   ```

### å®ä½“ç±»

```java
package com.tensquare.base.entity;

import constants.ModelConstants;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.Table;

@Data
@Entity
@NoArgsConstructor
@AllArgsConstructor
@Table(name = ModelConstants.TABLE_LABEL)
public class Label {

    @Id
    private String id;

    /**
     * æ ‡ç­¾åç§°
     */
    private String labelname;

    /**
     * æ ‡ç­¾çŠ¶æ€, 0ï¼šæ— æ•ˆ  1ï¼šæœ‰æ•ˆ
     */
    private String state;

    /**
     * ä½¿ç”¨æ•°é‡
     */
    private Long count;

    /**
     * æ˜¯å¦æ¨è, 0ï¼šä¸æ¨è  1ï¼šæ¨è
     */
    private String recommend;

    /**
     * å…³æ³¨æ•°
     */
    private Long fans;
}

```

è¿™é‡Œæˆ‘æ­£åœ¨`tensquare`ä¸­æ–°å»ºäº†`ModelConstants`ä¸“é—¨å­˜æ”¾å®ä½“ç›¸å…³çš„ä¸€äº›å¸¸é‡ï¼Œæ¯”å¦‚è¡¨åç§°ï¼Œå­—æ®µåç§°ç­‰

`ModelConstants`å¦‚ä¸‹ï¼š

```java
package constants;

/**
 * æ¨¡å‹å¸¸é‡ç±»
 */
public class ModelConstants {
    /**
     * è¡¨åç§°å¸¸é‡
     */
    public static final String TABLE_LABEL = "tb_label";
}
```

### config

1. IdWorkerProperties

   ```java
   package com.tensquare.base.config;
   
   import lombok.Data;
   import org.springframework.boot.context.properties.ConfigurationProperties;
   
   @Data
   @ConfigurationProperties("tensquare.worker")
   public class IdWorkerProperties {
   
       /**
        * èŠ‚ç‚¹ID
        */
       private Long workerId;
   
       /**
        * æœºå™¨ID
        */
       private Long datacenterId;
   
   }
   ```

   éœ€è¦åœ¨`application.yaml`ä¸­é…ç½®ï¼š

   ```yaml
   tensquare:
     worker:
       workerId: 1
       datacenterId: 1
   ```

2. IdWorkerConfiguration

   ```java
   package com.tensquare.base.config;
   
   import org.springframework.beans.factory.annotation.Autowired;
   import org.springframework.boot.context.properties.EnableConfigurationProperties;
   import org.springframework.context.annotation.Bean;
   import org.springframework.context.annotation.Configuration;
   import util.IdWorker;
   
   @Configuration
   @EnableConfigurationProperties(IdWorkerProperties.class)
   public class IdWorkerConfiguration {
   
       @Autowired
       private IdWorkerProperties prop;
   
   
       @Bean
       public IdWorker getIdWorker() {
           return new IdWorker(prop.getWorkerId(), prop.getDatacenterId());
       }
   
   }
   ```

### controller

```java
package com.tensquare.base.controller;

import com.tensquare.base.entity.Label;
import com.tensquare.base.service.LabelService;
import entity.Result;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("label")
public class LabelController {

    @Autowired
    private LabelService labelService;

    @PostMapping
    public Result insert(@RequestBody Label label) {
        labelService.save(label);
        return Result.ok("æ–°å¢æˆåŠŸ");
    }

    @GetMapping
    public Result queryLabels() {
        List<Label> labelList = labelService.findAll();
        return Result.ok(labelList);
    }

    @GetMapping("{labelId}")
    public Result queryById(@PathVariable("labelId") String id) {
        return Result.ok(labelService.findById(id));
    }

    @DeleteMapping("{labelId}")
    public Result remove(@PathVariable("labelId") String id) {
        labelService.deleteById(id);
        return Result.ok("åˆ é™¤æˆåŠŸ");
    }

    @PutMapping("{labelId}")
    public Result update(@RequestBody Label label,
                         @PathVariable("labelId") String id) {
        label.setId(id);
        labelService.update(label);
        return Result.ok("ä¿®æ”¹æˆåŠŸ");
    }

    @PostMapping("/search/{page}/{size}")
    public Result queryByPage(@RequestBody Map searchMap,
                              @PathVariable("page") int page,
                              @PathVariable("size") int size) {
        return Result.ok(labelService.queryByPage(searchMap, page, size));
    }


}
```

### service

```java
package com.tensquare.base.service;

import com.tensquare.base.dao.LabelRepository;
import com.tensquare.base.entity.Label;
import entity.PageResult;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.jpa.domain.Specification;
import org.springframework.stereotype.Service;
import org.springframework.util.StringUtils;
import util.IdWorker;

import javax.persistence.criteria.Predicate;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;

@Service
public class LabelService {

    @Autowired
    private LabelRepository labelRepository;

    @Autowired
    private IdWorker idWorker;

    public Label save(Label label) {
        label.setId(idWorker.nextId().toString());
        return labelRepository.save(label);
    }

    public List<Label> findAll() {
        return labelRepository.findAll();
    }

    public Label findById(String id) {
        return labelRepository.findById(id).get();
    }

    public void deleteById(String id) {
        labelRepository.deleteById(id);
    }

    public void update(Label label) {
        labelRepository.save(label);
    }

    /**
     * åˆ†é¡µ+æ¡ä»¶
     */
    public PageResult<Label> queryByPage(Map searchMap, int page, int size) {
        Specification<Label> specification = createSpecification(searchMap);
        Page<Label> labelPage = labelRepository.findAll(specification, PageRequest.of(page, size));
        return new PageResult<>(labelPage.getTotalElements(), labelPage.getContent());
    }

    public List<Label> findAll(Map searchMap) {
        Specification<Label> specification = createSpecification(searchMap);
        return labelRepository.findAll(specification);
    }

    /**
     * æ„å»ºæŸ¥è¯¢æ¡ä»¶
     *
     * @param searchMap æŸ¥è¯¢æ¡ä»¶
     * @return Specification æŸ¥è¯¢è§„æ ¼
     */
    private Specification<Label> createSpecification(Map searchMap) {
        String labelname = (String) searchMap.get("labelname");
        String state = (String) searchMap.get("state");
        String recommend = (String) searchMap.get("recommend");
        return (Specification<Label>) (root, criteriaQuery, criteriaBuilder) -> {
            List<Predicate> predicateList = new ArrayList<>();

            if (!StringUtils.isEmpty(labelname)) {
                predicateList.add(criteriaBuilder.like(root.get("labelname").as(String.class), "%" + labelname + "%"));
            }
            if (!StringUtils.isEmpty(state)) {
                predicateList.add(criteriaBuilder.equal(root.get("state").as(String.class),  state));
            }
            if (!StringUtils.isEmpty(recommend)) {
                predicateList.add(criteriaBuilder.equal(root.get("recommend").as(String.class), "%" + recommend + "%"));
            }
            return criteriaBuilder.and(predicateList.toArray(new Predicate[predicateList.size()]));
        };
    }
}
```

### dao

```java
package com.tensquare.base.dao;

import com.tensquare.base.entity.Label;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;

public interface LabelRepository extends JpaRepository<Label, String>, JpaSpecificationExecutor<Label> {
}
```

## ç»Ÿä¸€å¼‚å¸¸å¤„ç†

```java
package com.tensquare.base.exception;

import entity.Result;
import entity.StatusCode;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

@Slf4j
@RestControllerAdvice
public class BaseExceptionHandler {

    @ExceptionHandler(Exception.class)
    public Result error(Exception e) {
        log.error("[å‘ç”Ÿå¼‚å¸¸] ", e);
        return Result.error(StatusCode.ERROR.getStatusCode(), StatusCode.ERROR.getDefaultMessage());
    }

}
```

