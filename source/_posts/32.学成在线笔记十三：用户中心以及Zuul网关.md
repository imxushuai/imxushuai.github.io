---
title: å­¦æˆåœ¨çº¿ç¬”è®°åä¸‰ï¼šç”¨æˆ·ä¸­å¿ƒä»¥åŠZuulç½‘å…³
tags:
  - å­¦æˆåœ¨çº¿é¡¹ç›®
  - é»‘é©¬å­¦æˆåœ¨çº¿
  - åœ¨çº¿æ•™è‚²é¡¹ç›®
  - å®æˆ˜å­¦æˆåœ¨çº¿
  - å­¦æˆåœ¨çº¿ç¬”è®°
categories:
  - å­¦æˆåœ¨çº¿

date: 2020-06-20 18:57:45
---

<center><i>ç”¨æˆ·ä¸­å¿ƒè®¤è¯å¼€å‘ä»¥åŠ Zuul ç½‘å…³</i></center>

![](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/master/jiaoyu.jpg)

<!-- more -->

# ç”¨æˆ·è®¤è¯

## è®¤è¯æµç¨‹åˆ†æ

![https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/ca73b873844f57a12898f44c21fe3927808e653f/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81zuul-%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/ca73b873844f57a12898f44c21fe3927808e653f/ç”¨æˆ·è®¤è¯zuul-ç”¨æˆ·è®¤è¯æµç¨‹å›¾.jpg)

1. å®¢æˆ·ç«¯è¯·æ±‚è®¤è¯æœåŠ¡è¿›è¡Œè®¤è¯ã€‚
2. è®¤è¯æœåŠ¡è®¤è¯é€šè¿‡å‘æµè§ˆå™¨`cookie`å†™å…¥`token(èº«ä»½ä»¤ç‰Œ)`
   - è®¤è¯æœåŠ¡è¯·æ±‚ç”¨æˆ·ä¸­å¿ƒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚
   - è®¤è¯æœåŠ¡è¯·æ±‚`Spring Security`ç”³è¯·ä»¤ç‰Œã€‚
   - è®¤è¯æœåŠ¡å°†`token(èº«ä»½ä»¤ç‰Œ)`å’Œ`jwtä»¤ç‰Œ`å­˜å‚¨è‡³`redis`ä¸­ã€‚
   - è®¤è¯æœåŠ¡å‘`cookie`å†™å…¥ `token(èº«ä»½ä»¤ç‰Œ)`ã€‚
3. å‰ç«¯æºå¸¦`token`è¯·æ±‚è®¤è¯æœåŠ¡è·å–`jwtä»¤ç‰Œ`
   - å‰ç«¯è·å–åˆ°`jwtä»¤ç‰Œ`å¹¶å­˜å‚¨åœ¨`sessionStorage`ã€‚
   - å‰ç«¯ä»`jwtä»¤ç‰Œ`ä¸­è§£æä¸­ç”¨æˆ·ä¿¡æ¯å¹¶æ˜¾ç¤ºåœ¨é¡µé¢ã€‚
4. å‰ç«¯æºå¸¦`cookie`ä¸­çš„`token`èº«ä»½ä»¤ç‰ŒåŠ`jwtä»¤ç‰Œ`è®¿é—®èµ„æºæœåŠ¡
   - å‰ç«¯è¯·æ±‚èµ„æºæœåŠ¡éœ€è¦æºå¸¦ä¸¤ä¸ª`token`ï¼Œä¸€ä¸ªæ˜¯`cookie`ä¸­çš„èº«ä»½ä»¤ç‰Œï¼Œä¸€ä¸ªæ˜¯`http header`ä¸­çš„`jwtä»¤ç‰Œ`
   - å‰ç«¯è¯·æ±‚èµ„æºæœåŠ¡å‰åœ¨`http header`ä¸Šæ·»åŠ `jwt`è¯·æ±‚èµ„æº
5. ç½‘å…³æ ¡éªŒtokençš„åˆæ³•æ€§

## è®¤è¯æµç¨‹æŸ¥è¯¢æ•°æ®åº“

### é¡¹ç›®å¯¼å…¥ã€æ­å»ºï¼ˆçœç•¥ï¼‰

### æ–°å¢API

```java
package com.xuecheng.api.ucenter;

import com.xuecheng.framework.domain.ucenter.ext.XcUserExt;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;

@Api(value = "ç”¨æˆ·ä¸­å¿ƒ", description = "ç”¨æˆ·ä¸­å¿ƒç®¡ç†")
public interface UcenterControllerApi  {

    @ApiOperation("æŒ‰ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯")
    XcUserExt findByUsername(String username);

}

```

### UcenterController

```java
package com.xuecheng.ucenter.controller;

import com.xuecheng.api.ucenter.UcenterControllerApi;
import com.xuecheng.framework.domain.ucenter.ext.XcUserExt;
import com.xuecheng.ucenter.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("ucenter")
public class UserController implements UcenterControllerApi {


    @Autowired
    private UserService userService;

    @Override
    @GetMapping("getuserext")
    public XcUserExt findByUsername(@RequestParam("username") String username) {
        return userService.findByUsername(username);
    }
}
```

### UcenterService

```java
package com.xuecheng.ucenter.service;

import com.xuecheng.framework.domain.ucenter.XcCompanyUser;
import com.xuecheng.framework.domain.ucenter.XcUser;
import com.xuecheng.framework.domain.ucenter.ext.XcUserExt;
import com.xuecheng.ucenter.dao.XcCompanyUserRepository;
import com.xuecheng.ucenter.dao.XcUserRepository;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserService {

    @Autowired
    private XcUserRepository xcUserRepository;

    @Autowired
    private XcCompanyUserRepository xcCompanyUserRepository;


    /**
     * æŒ‰ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
     *
     * @param username ç”¨æˆ·å
     * @return ç”¨æˆ·ä¿¡æ¯
     */
    public XcUserExt findByUsername(String username) {
        XcUserExt result = new XcUserExt();

        // æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
        XcUser userInfo = xcUserRepository.findByUsername(username);
        if (userInfo == null) {
            return null;
        }

        BeanUtils.copyProperties(userInfo, result);

        // æŸ¥è¯¢ç”¨æˆ·å…¬å¸ä¿¡æ¯
        XcCompanyUser companyUser = xcCompanyUserRepository.findByUserId(userInfo.getId());
        if (companyUser != null) {
            result.setCompanyId(companyUser.getCompanyId());
        }

        return result;
    }
}
```

### XcUserRepository & XcCompanyUserRepository

- XcUserRepository

  ```java
  package com.xuecheng.ucenter.dao;
  
  import com.xuecheng.framework.domain.ucenter.XcUser;
  import org.springframework.data.jpa.repository.JpaRepository;
  
  public interface XcUserRepository extends JpaRepository<XcUser, String> {
  
      XcUser findByUsername(String username);
  
  }
  ```

- XcCompanyUserRepository

  ```java
  package com.xuecheng.ucenter.dao;
  
  import com.xuecheng.framework.domain.ucenter.XcCompanyUser;
  import org.springframework.data.jpa.repository.JpaRepository;
  
  public interface XcCompanyUserRepository extends JpaRepository<XcCompanyUser, String> {
  
      XcCompanyUser findByUserId(String userId);
  
  }
  ```

### æ¥å£æµ‹è¯•

 è®¿é—®æ¥å£ï¼š

```http
GET http://localhost:40300/ucenter/getuserext?username=t1
```

æ­£å¸¸æŸ¥è¯¢åˆ°æ•°æ®ï¼š

![https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/4094c2e584c7d81ffc78e909fb1aae324c07dbdf/QQ%E6%88%AA%E5%9B%BE20200620132147.png](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/4094c2e584c7d81ffc78e909fb1aae324c07dbdf/QQæˆªå›¾20200620132147.png)

### ç¼–å†™Feignå®¢æˆ·ç«¯

```java
package com.xuecheng.auth;

import com.xuecheng.framework.client.XcServiceList;
import com.xuecheng.framework.domain.ucenter.ext.XcUserExt;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;

@FeignClient(XcServiceList.XC_SERVICE_UCENTER)
public interface UserClient {

    @GetMapping("ucenter/getuserext")
    XcUserExt findByUsername(@RequestParam("username") String username);

}
```

### ä¿®æ”¹UserDetailsServiceImplé€»è¾‘

ä¿®æ”¹`xc-service-ucenter-auth`çš„`UserDetailsServiceImpl`éƒ¨åˆ†é€»è¾‘ï¼Œé‡‡ç”¨æŸ¥è¯¢è¿œç¨‹è°ƒç”¨`Ucenter`çš„`API`è·å–ç”¨æˆ·æ•°æ®ï¼Œç„¶åä¸å‰ç«¯ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œæ¯”å¯¹ã€‚

![https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/6e720d2bde2b913490b208ad3022a484a946a083/QQ%E6%88%AA%E5%9B%BE20200620132939.png](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/6e720d2bde2b913490b208ad3022a484a946a083/QQæˆªå›¾20200620132939.png)

ä¸‹é¢ä¿®æ”¹åçš„`loadUserByUsername`æ–¹æ³•çš„ä»£ç 

```java
public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        //å–å‡ºèº«ä»½ï¼Œå¦‚æœèº«ä»½ä¸ºç©ºè¯´æ˜æ²¡æœ‰è®¤è¯
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        //æ²¡æœ‰è®¤è¯ç»Ÿä¸€é‡‡ç”¨httpbasicè®¤è¯ï¼Œhttpbasicä¸­å­˜å‚¨äº†client_idå’Œclient_secretï¼Œå¼€å§‹è®¤è¯client_idå’Œclient_secret
        if (authentication == null) {
            ClientDetails clientDetails = clientDetailsService.loadClientByClientId(username);
            if (clientDetails != null) {
                //å¯†ç 
                String clientSecret = clientDetails.getClientSecret();
                return new User(username, clientSecret, AuthorityUtils.commaSeparatedStringToAuthorityList(""));
            }
        }
        if (StringUtils.isEmpty(username)) {
            return null;
        }

        // æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
        XcUserExt userext = userClient.findByUsername(username);
        if (userext == null) {
            return null;
        }
        //ä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·æ­£ç¡®çš„å¯†ç ï¼ŒSpring Securityä¼šå»æ¯”å¯¹è¾“å…¥å¯†ç çš„æ­£ç¡®æ€§
        String password = userext.getPassword();
        String user_permission_string = "";
        UserJwt userDetails = new UserJwt(username,
                password,
                AuthorityUtils.commaSeparatedStringToAuthorityList(user_permission_string));
        userDetails.setId(userext.getId());
        userDetails.setUtype(userext.getUtype());//ç”¨æˆ·ç±»å‹
        userDetails.setCompanyId(userext.getCompanyId());//æ‰€å±ä¼ä¸š
        userDetails.setName(userext.getName());//ç”¨æˆ·åç§°
        userDetails.setUserpic(userext.getUserpic());//ç”¨æˆ·å¤´åƒ
        return userDetails;
    }
```

### æµ‹è¯•ç™»å½•

![https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/fb0ed5c6ed8a15d487a700609c15e85e407e5977/QQ%E6%88%AA%E5%9B%BE20200620133756.png](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/fb0ed5c6ed8a15d487a700609c15e85e407e5977/QQæˆªå›¾20200620133756.png)

æˆåŠŸç™»å½•

## ç”¨æˆ·ç™»å½•å‰ç«¯

> å·²ç»æ˜¯åšå¥½äº†çš„ï¼Œä»£ç ä¸éœ€è¦åŠ¨ï¼Œå°±ä¸åšç¬”è®°äº†ã€‚

## æ˜¾ç¤ºå½“å‰ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯

### è§£å†³æ–¹æ¡ˆ

![https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/dedf12e337e01e44059495a8aa589d535de75062/%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81-%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF.jpg](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/dedf12e337e01e44059495a8aa589d535de75062/ç”¨æˆ·è®¤è¯-è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯.jpg)

1. ç”¨æˆ·è¯·æ±‚è®¤è¯æœåŠ¡ï¼Œç™»å½•æˆåŠŸã€‚
2. ç”¨æˆ·ç™»å½•æˆåŠŸï¼Œè®¤è¯æœåŠ¡å‘`cookie`å†™å…¥èº«ä»½ä»¤ç‰Œï¼Œå‘`redis`å†™å…¥`user_token`ï¼ˆèº«ä»½ä»¤ç‰ŒåŠæˆæƒjwtæˆæƒä»¤ç‰Œï¼‰  
3. å®¢æˆ·ç«¯æºå¸¦`cookie`ä¸­çš„èº«ä»½ä»¤ç‰Œè¯·æ±‚è®¤è¯æœåŠ¡è·å–`jwtä»¤ç‰Œ`ã€‚
4. å®¢æˆ·ç«¯è§£æ`jwtä»¤ç‰Œ`ï¼Œå¹¶å°†è§£æçš„ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°`sessionStorage`ä¸­ã€‚`jwtä»¤ç‰Œ`ä¸­åŒ…æ‹¬äº†ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯è§£æ`jwtä»¤ç‰Œ`å³å¯è·å–ç”¨æˆ·ä¿¡æ¯ã€‚
5. å®¢æˆ·ç«¯ä»`sessionStorage`ä¸­è¯»å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶åœ¨é¡µå¤´æ˜¾ç¤ºã€‚

### åç«¯ï¼šJWTæŸ¥è¯¢æ¥å£

1. åœ¨`AuthControllerApi`ä¸­æ–°å¢API

   ```java
       @ApiOperation("æŸ¥è¯¢user jwtä»¤ç‰Œ")
       JwtResult userjwt();
   ```

2. APIå®ç°

   ```java
       @Override
       @GetMapping("userjwt")
       public JwtResult userjwt() {
           String access_token = getTokenFormCookie();
           AuthToken authToken = authService.getUserToken(access_token);
           if(authToken == null){
               return new JwtResult(CommonCode.FAIL,null);
           }
           return new JwtResult(CommonCode.SUCCESS,authToken.getJwt_token());
       }
   
       //ä»cookieä¸­è¯»å–è®¿é—®ä»¤ç‰Œ
       private String getTokenFormCookie(){
           HttpServletRequest request = ((ServletRequestAttributes)
                   RequestContextHolder.getRequestAttributes()).getRequest();
           Map<String, String> cookieMap = CookieUtil.readCookie(request, "uid");
           return cookieMap.get("uid");
       }
   ```

3. `AuthService`æ–°å¢æ–¹æ³•

   ```java
       /**
        * æŸ¥è¯¢ç”¨æˆ·jwtä»¤ç‰Œ
        *
        * @param access_token token
        * @return auth token
        */
       public AuthToken getUserToken(String access_token) {
           String userToken = "user_token:" + access_token;
           String userTokenString = stringRedisTemplate.opsForValue().get(userToken);
           AuthToken authToken = null;
           try {
               authToken = JSON.parseObject(userTokenString, AuthToken.class);
           } catch (Exception e) {
               LOGGER.error("getUserToken from redis and execute JSON.parseObject error {}", e.getMessage());
               e.printStackTrace();
           }
           return authToken;
       }
   ```

4. æµ‹è¯•

   è°ƒç”¨ç™»é™†è¿‡åï¼Œè°ƒç”¨`userjwt`æ¥å£

   ![https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/cdda3b5b49ed1a836b161507d62a384999a816c5/QQ%E6%88%AA%E5%9B%BE20200620144321.png](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/cdda3b5b49ed1a836b161507d62a384999a816c5/QQæˆªå›¾20200620144321.png)

   æˆåŠŸè·å–åˆ°`jwtä»¤ç‰Œ`

### å‰ç«¯ï¼šè°ƒç”¨APIè·å–JWT

> ä»£ç å†™å¥½äº†çš„ï¼Œé…ç½®ä¸€ä¸‹`nginx`å°±å®Œäº‹äº†ã€‚

## ç”¨æˆ·é€€å‡º(çœç•¥)

> æ¸…é™¤`Redis`å’Œ`Cookie`ä¸­çš„`token`

# Zuul ç½‘å…³

## Zuul ç½‘å…³æ¦‚è¿°

å‚è€ƒæ–‡ç« ï¼šğŸ‘‰[Spring Cloud Zuulç½‘å…³](https://www.imxushuai.com/2018/12/05/spring-cloud-zuulç½‘å…³)ğŸ‘ˆ

## ç½‘å…³é¡¹ç›®å¯¼å…¥ï¼ˆçœç•¥ï¼‰

## é…ç½®è·¯ç”±

```yml
zuul:
  routes:
    xc-service-learning: #è·¯ç”±åç§°ï¼Œåç§°ä»»æ„ï¼Œä¿æŒæ‰€æœ‰è·¯ç”±åç§°å”¯ä¸€
      path: /learning/**
      serviceId: xc-service-learning
      strip-prefix: false
      sensitiveHeaders:
    manage-course:
      path: /course/**
      serviceId: xc-service-manage-course
      strip-prefix: false
      sensitiveHeaders:
    manage-cms:
      path: /cms/**
      serviceId: xc-service-manage-cms
      strip-prefix: false
      sensitiveHeaders:
    manage-sys:
      path: /sys/**
      serviceId: xc-service-manage-cms
      strip-prefix: false
      sensitiveHeaders:
    service-ucenter:
      path: /ucenter/**
      serviceId: xc-service-ucenter
      sensitiveHeaders:
      strip-prefix: false
    xc-service-manage-order:
      path: /order/**
      serviceId: xc-service-manage-order
      sensitiveHeaders:
      strip-prefix: false
```

## AuthService

åœ¨`gateway`é¡¹ç›®ä¸­ç¼–å†™`AuthService`

```java
package com.xuecheng.govern.gateway.service;

import com.xuecheng.framework.utils.CookieUtil;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.core.StringRedisTemplate;

import javax.servlet.http.HttpServletRequest;
import java.util.Map;

public class AuthService {
    @Autowired
    StringRedisTemplate stringRedisTemplate;

    //æŸ¥è¯¢èº«ä»½ä»¤ç‰Œ
    public String getTokenFromCookie(HttpServletRequest request) {
        Map<String, String> cookieMap = CookieUtil.readCookie(request, "uid");
        String access_token = cookieMap.get("uid");
        if (StringUtils.isEmpty(access_token)) {
            return null;
        }
        return access_token;
    }

    //ä»headerä¸­æŸ¥è¯¢jwtä»¤ç‰Œ
    public String getJwtFromHeader(HttpServletRequest request) {
        String authorization = request.getHeader("Authorization");
        if (StringUtils.isEmpty(authorization)) {
            //æ‹’ç»è®¿é—®
            return null;
        }
        if (!authorization.startsWith("Bearer ")) {
            //æ‹’ç»è®¿é—®
            return null;
        }
        return authorization;
    }

    //æŸ¥è¯¢ä»¤ç‰Œçš„æœ‰æ•ˆæœŸ
    public long getExpire(String access_token) {
        //tokenåœ¨redisä¸­çš„key
        String key = "user_token:" + access_token;
        return stringRedisTemplate.getExpire(key);
    }

}
```

## è¿‡æ»¤å™¨

åœ¨`gateway`é¡¹ç›®ä¸­ç¼–å†™è¿‡æ»¤å™¨

```java
package com.xuecheng.govern.gateway.filter;

import com.alibaba.fastjson.JSON;
import com.netflix.zuul.ZuulFilter;
import com.netflix.zuul.context.RequestContext;
import com.netflix.zuul.exception.ZuulException;
import com.xuecheng.framework.model.response.CommonCode;
import com.xuecheng.framework.model.response.ResponseResult;
import com.xuecheng.govern.gateway.service.AuthService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import javax.servlet.http.HttpServletRequest;

@Component
public class LoginFilter extends ZuulFilter {

    private static final Logger LOG = LoggerFactory.getLogger(LoginFilter.class);

    @Autowired
    private AuthService authService;

    @Override
    public String filterType() {
        //å››ç§ç±»å‹ï¼špreã€routingã€postã€error
        return "pre";
    }

    @Override
    public int filterOrder() {
        return 0;
    }

    @Override
    public boolean shouldFilter() {
        return true;
    }


    @Override
    public Object run() throws ZuulException {
        //ä¸Šä¸‹æ–‡å¯¹è±¡
        RequestContext requestContext = RequestContext.getCurrentContext();
        //è¯·æ±‚å¯¹è±¡
        HttpServletRequest request = requestContext.getRequest();
        //æŸ¥è¯¢èº«ä»½ä»¤ç‰Œ
        String access_token = authService.getTokenFromCookie(request);
        if (access_token == null) {
            //æ‹’ç»è®¿é—®
            access_denied();
            return null;
        }
        //ä»redisä¸­æ ¡éªŒèº«ä»½ä»¤ç‰Œæ˜¯å¦è¿‡æœŸ
        long expire = authService.getExpire(access_token);
        if (expire <= 0) {
            //æ‹’ç»è®¿é—®
            access_denied();
            return null;
        }
        //æŸ¥è¯¢jwtä»¤ç‰Œ
        String jwt = authService.getJwtFromHeader(request);
        if (jwt == null) {
            //æ‹’ç»è®¿é—®
            access_denied();
            return null;
        }
        return null;
    }

    /**
     * æ‹’ç»è®¿é—®
     */
    private void access_denied() {
        //ä¸Šä¸‹æ–‡å¯¹è±¡
        RequestContext requestContext = RequestContext.getCurrentContext();
        requestContext.setSendZuulResponse(false);      //æ‹’ç»è®¿é—®
        //è®¾ç½®å“åº”å†…å®¹
        ResponseResult responseResult = new ResponseResult(CommonCode.UNAUTHENTICATED);
        String responseResultString = JSON.toJSONString(responseResult);
        requestContext.setResponseBody(responseResultString);
        //è®¾ç½®çŠ¶æ€ç 
        requestContext.setResponseStatusCode(200);
        requestContext.getResponse().setContentType("application/json;charset=utf-8");
    }
}
```

## é…ç½®Nginx

```conf
	#å¾®æœåŠ¡ç½‘å…³, é…ç½®åœ¨serverå¤–éƒ¨
	upstream api_server_pool{
		server 127.0.0.1:50201 weight=10;
	}
    #å¾®æœåŠ¡ç½‘å…³, é…ç½®åœ¨ç›‘å¬80ç«¯å£çš„serverå†…éƒ¨
    location /api {
    	proxy_pass http://api_server_pool;
    }
```

## æµ‹è¯•

ä½¿ç”¨`token`è°ƒç”¨`API`

![https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/785cf43097f8e2dd4db1ff8cf159d5bed11e2402/QQ%E6%88%AA%E5%9B%BE20200620184744.png](https://imxushuai-01.coding.net/p/pic/d/pic/git/raw/785cf43097f8e2dd4db1ff8cf159d5bed11e2402/QQæˆªå›¾20200620184744.png)

